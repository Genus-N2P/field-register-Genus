<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Field Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-dark: #112b4e;
      --primary-mid: #8895a6;
      --primary-accent: #ec7723;

      --dark-80: rgba(17, 43, 78, 0.8);
      --dark-60: rgba(17, 43, 78, 0.6);
      --dark-40: rgba(17, 43, 78, 0.4);
      --dark-20: rgba(17, 43, 78, 0.2);
      --dark-10: rgba(17, 43, 78, 0.1);
      --dark-05: rgba(17, 43, 78, 0.05);

      --accent-80: rgba(236, 119, 35, 0.8);
      --accent-60: rgba(236, 119, 35, 0.6);
      --accent-40: rgba(236, 119, 35, 0.4);
      --accent-20: rgba(236, 119, 35, 0.2);
      --accent-10: rgba(236, 119, 35, 0.1);
      --accent-05: rgba(236, 119, 35, 0.05);
    }

    body {
      font-family: 'Exo', sans-serif;
      background-color: #f9f9f9;
      color: var(--primary-dark);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    header {
      background-color: var(--primary-dark);
      height: 350px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: white;
      padding: 0 2rem;
    }

    .header-logo {
      height: 300px;
      width: auto;
      object-fit: contain;
      max-width: 600px;
    }

    .header-title {
      flex: 1;
      text-align: center;
    }

    .header-title h1 {
      font-weight: 600;
      font-size: 3rem;
      margin: 0;
    }

    .header-spacer {
      width: 300px; /* Same as logo width to center the title */
    }

    /* Responsive media queries for header logo */
    @media screen and (max-width: 1200px) {
      .header-logo {
        height: 250px;
        max-width: 500px;
      }
      .header-spacer {
        width: 250px;
      }
      .header-title h1 {
        font-size: 2.5rem;
      }
    }

    @media screen and (max-width: 768px) {
      header {
        height: 250px;
        padding: 0 1rem;
      }
      .header-logo {
        height: 200px;
        max-width: 350px;
      }
      .header-spacer {
        width: 200px;
      }
      .header-title h1 {
        font-size: 2rem;
      }
    }

    @media screen and (max-width: 480px) {
      header {
        height: 200px;
        padding: 0 0.5rem;
      }
      .header-logo {
        height: 160px;
        max-width: 200px;
      }
      .header-spacer {
        width: 160px;
      }
      .header-title h1 {
        font-size: 1.5rem;
      }
    }

    @media screen and (max-width: 320px) {
      header {
        height: 180px;
      }
      .header-logo {
        height: 130px;
        max-width: 150px;
      }
      .header-spacer {
        width: 130px;
      }
      .header-title h1 {
        font-size: 1.3rem;
      }
    }

    .container {
      max-width: 1000px;
      margin: -50px auto 0 auto;
      padding: 2rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 0 10px var(--dark-10);
    }

    .form-switcher {
      margin-bottom: 2rem;
    }

    .form-switcher h2 {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .form-switcher button {
      background-color: var(--accent-60);
      border: none;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      margin: 0.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .form-switcher button:hover {
      background-color: var(--primary-accent);
    }

    .form-switcher button.active {
      background-color: var(--primary-accent);
    }

    .btn-back {
      background-color: #6c757d !important;
    } 
      
    .btn-back:hover {
      background-color: #5a6268 !important;
    }   
    
    .search-btn {
      background-color: var(--primary-accent);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    } 
      
    .thank-you-message {
      background-color: var(--accent-10);
      border: 2px solid var(--primary-accent);
      color: var(--primary-dark);
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 2rem;
      display: none;
    }

    .hidden {
      display: none;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section h3 {
      font-size: 1.5rem;
      margin-top: 0;
    }

    label {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: 600;
    }

    legend {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: 600;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--dark-20);
      border-radius: 0.5rem;
      font-size: 1rem;
      font-family: 'Exo', sans-serif;
    }

    input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    .form-footer {
      margin-top: 2rem;
      display: flex;
      justify-content: space-between;
    }

    .form-footer button {
      background-color: var(--primary-accent);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }

.field-error input {
  border: 2px solid #dc3545;
  background-color: #fff5f5;
}

.field-error label {
  color: #dc3545;
  font-weight: bold;
}

.form-wrapper {
  border: 1px solid var(--dark-20); /* Subtle border */
  padding: 1.5rem;
  border-radius: 1rem;
  max-width: 100%;
  box-sizing: border-box;
  overflow-x: auto; /* Ensure horizontal scrolling if content overflows */
}

input,
select,
textarea {
  max-width: 100%;
  box-sizing: border-box;
}

/* Specific styling for discipline checkboxes and their error messages */
.discipline-checkbox-group.field-error {
  border: 2px solid #dc3545;
  padding: 10px;
  border-radius: 0.5rem;
  background-color: #fff5f5;
}

.discipline-checkbox-group.field-error label {
  color: #dc3545;
}

    /* Style for the conditional discipline fields */
    .discipline-conditional-fields {
        border-left: 3px solid var(--primary-accent);
        padding-left: 15px;
        margin-top: 10px;
        margin-bottom: 15px;
        background-color: var(--accent-05);
        border-radius: 0.5rem;
        padding-top: 10px;
        padding-bottom: 10px;
    }

/* Styles for the main discipline checkboxes' labels */
.discipline-checkbox-group > div label {
    font-weight: bold; /* Make these labels bold */
    color: var(--primary-dark); /* Use a darker color */
    display: inline; /* Keep them inline with their checkboxes */
    margin-left: 5px; /* Add some space if the input is first */
    /* Add any other styles specific to these main labels */
}

/* Styles for labels within the conditional discipline fields */
.discipline-conditional-fields label {
    font-size: 0.95rem; /* Slightly smaller font for these */
    color: var(--primary-mid); /* Use a lighter color */
    display: inline; /* Keep them inline with their checkboxes */
    margin-bottom: 0.5rem; /* Add space below them */    }

    .discipline-conditional-fields input[type="number"] {
        width: calc(100% - 20px); /* Adjust width to fit padding */
        margin-bottom: 10px;
    }
/* More specifically, styles for the day checkboxes' labels */
.discipline-conditional-fields .days-checkbox-group label {
    font-weight: normal; /* Ensure they are not bold */
    color: var(--primary-dark); /* Can revert to primary-dark for contrast */
    display: inline; /* Keep them inline with their checkboxes */
    margin-left: 5px; /* Space next to the checkbox */
    margin-bottom: 0; /* Remove block margin */
}
    .discipline-conditional-fields .days-checkbox-group div {
        flex: 1 1 auto; /* Allow items to grow and shrink */
        min-width: 100px; /* Minimum width for each day checkbox */
    }
    .discipline-conditional-fields .days-checkbox-group input[type="checkbox"] {
        margin-right: 5px;
    }
    .error-field {
        border: 2px solid red !important;
        background-color: #ffe0e0 !important;
    }
    /* Optional: Style for the error messages */
    .error-message {
        margin-top: 5px;
        margin-bottom: 10px;
    }

#pitlinkin-PitA-Note-ID {
  width: 100%;
}

.or-divider {
  display: flex;
  align-items: center;
  text-align: center;
  margin: 2rem 0;
  font-family: 'Exo', sans-serif;
}

.or-divider .line {
  flex-grow: 1;
  height: 1px;
  background-color: var(--accent-60);
  border: none;
}

.or-divider .or-text {
  padding: 0 1rem;
  font-weight: 600;
  color: var(--primary-accent);
  font-size: 1rem;
  white-space: nowrap;
}

.crew-checkbox {
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      background-color: #fff;
      padding: 1rem;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Exo', sans-serif;
    }
    .crew-checkbox label {
      display: block;
      margin-bottom: 0.25rem;
      cursor: pointer;
      color: var(--primary-dark);
    }
    .crew-checkbox input[type="checkbox"] {
      accent-color: var(--primary-accent);
      margin-right: 0.5rem;
      transform: scale(1.1);
    }
    .crew-checkbox p {
      color: var(--primary-mid);
      font-style: italic;
      margin: 0 0 0.5rem 0;
    }

fieldset.time-group {
  border: none;
  padding: 0;
  margin-top: 1rem;
}

fieldset.time-group legend {
  font-weight: bold;
  padding: 0;
  font-size: 1rem;
}

  </style>

<link rel="icon" href="favicon.png" type="image/png">
</head>
<body>
  <header>
    <img src="Field Register Header.png" alt="Field Register Logo" class="header-logo" />
    <div class="header-title">
      <h1>Field Register</h1>
    </div>
    <div class="header-spacer"></div>
  </header>

  <main class="container">
  <div class="form-wrapper">
  <div id="thank-you-message" class="thank-you-message" style="display: none;">
    <h3 id="message-title">Thank you!</h3>
    <p id="message-body">Your form has been submitted successfully.</p>
  </div>
    
    <section class="form-switcher">
      <h2>Please select which form you require:</h2>
      <button id="btn-forecast" onclick="showForm('forecast')">Subcontractor Weekly Forecast</button>
      <button id="btn-bog" onclick="showForm('bog')">Boots on Ground</button>
      <button id="btn-reinstatement" onclick="showForm('reinstatement')">Reinstatement Register</button>
      <button id="btn-pitlinkin" onclick="showForm('pitlinkin')">Pit Link-in Register</button>
      <button id="btn-vactruck" onclick="showForm('vactruck')">Vac Truck Register</button>
      <button id="btn-gearbox" onclick="showForm('gearbox')">Fleet Maintenance Register</button>
    </section>

    <div id="form-forecast" class="form-section hidden">
        <h3>Subcontractor Weekly Forecast: Genus N2P project</h3>
        <p>Please complete weekly by <strong><u>5pm Thursday</u></strong>.<br>This is a new reporting requirement implemented by nbn.</p>
        <p>Week Commencing: <strong id="weekCommencingDate">Calculating...</strong> | Week Ending: <strong id="weekEndingDate">Calculating...</strong></p>
        <form id="forecast-form" onsubmit="">

            <label for="forecast-company-name">Your Company Name</label>
            <select id="forecast-company-name" name="forecast-company-name" required>
          <option value="Boretech Contracting">Boretech Contracting</option>
          <option value="Connectit Communications">Connectit Communications</option>
          <option value="Dawn Techcomms">Dawn Techcomms</option>
          <option value="DDS Underground">DDS Underground</option>
          <option value="Dizza Communications">Dizza Communications</option>
          <option value="Djara Network Service">Djara Network Service</option>
          <option value="Feverpitch Enterprises">Feverpitch Enterprises</option>
          <option value="Genus Services" selected>Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="Lightsource">Lightsource</option>
          <option value="MNC Drilling">MNC Drilling</option>
          <option value="Netline Services">Netline Services</option>
          <option value="Syndicate Communications">Syndicate Communications</option>
          <option value="TAT Communications">TAT Communications</option>
          <option value="Versatile Services">Versatile Services</option>
        </select>

    <label for="forecast-site-contact">Crew Lead Contact Name</label>
    <div id="forecast-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="forecast-site-contact-hidden" name="forecast-site-contact" required />

	<label for="forecast-onsite-crew-lead-mobile">Crew Lead Contact Mobile</label>
        <input type="tel" id="forecast-onsite-crew-lead-mobile" name="forecast-onsite-crew-lead-mobile" pattern="04\d{8}" maxlength="10" placeholder="Enter 10-digit mobile number (04xxxxxxxx)" oninvalid="this.setCustomValidity('Enter number as 04xxxxxxxx')" oninput="this.setCustomValidity('')" required />

        <label for="forecast-onsite-crew-lead-email">Crew Lead Contact Email</label>
        <input type="text" id="forecast-onsite-crew-lead-email" name="forecast-onsite-crew-lead-email" />

        <label for="forecast-onsite-crew-lead-EnableID">Crew Lead Contact Enable ID (if applicable)</label>
        <input type="text" id="forecast-onsite-crew-lead-EnableID" name="forecast-onsite-crew-lead-EnableID" />

        <label for="forecast-Genus-FCM">Your Genus FCM</label>
        <select id="forecast-Genus-FCM" name="forecast-Genus-FCM" required>
          <option value="">Select one</option>
          <option value="Alex McConville">Alex McConville</option>
          <option value="Jason Curd">Jason Curd</option>
          <option value="Riaz Ejtahed">Riaz Ejtahed</option>
        </select>

            <label for="forecast-sam-id">SAM ID - Please submit 1 form per SAM.</label>
            <select id="forecast-sam-id" name="forecast-sam-id" required>
          <option value="">Select one</option>
     <optgroup label="Gascoyne">
          <option value="K-6CVN-20">K-6CVN-20</option>
          <option value="K-6DNH-20">K-6DNH-20</option>
          <option value="K-6EXM-01">K-6EXM-01</option>
     </optgroup>
     <optgroup label="Goldfields-Esperance">
          <option value="K-6CGD-20">K-6CGD-20</option>
          <option value="K-6ESP-20">K-6ESP-20</option>
          <option value="K-6ESP-21">K-6ESP-21</option>
          <option value="K-6ESP-40">K-6ESP-40</option>
          <option value="K-6HOP-01">K-6HOP-01</option>
          <option value="K-6KAM-20">K-6KAM-20</option>
     </optgroup>
     <optgroup label="Great Southern">
          <option value="K-6ALN-22">K-6ALN-22</option>
          <option value="L-6ALN-05">L-6ALN-05</option>
          <option value="L-6ALN-20">L-6ALN-20</option>
          <option value="L-6ALN-21">L-6ALN-21</option>
          <option value="L-6ALN-23">L-6ALN-23</option>
          <option value="X-6ALN-05">X-6ALN-05</option>
          <option value="K-6DNK-20">K-6DNK-20</option>
          <option value="K-6KAT-20">K-6KAT-20</option>
     </optgroup>
     <optgroup label="Mid West">
          <option value="K-6KLB-01">K-6KLB-01</option>
          <option value="K-6LEA-20">K-6LEA-20</option>
     </optgroup>
     <optgroup label="Pilbara">
          <option value="K-6NWM-01">K-6NWM-01</option>
          <option value="K-6NWM-20">K-6NWM-20</option>
          <option value="K-6PDO-20">K-6PDO-20</option>
          <option value="K-6TPC-20">K-6TPC-20</option>
          <option value="X-6TPC-20">K-6TPC-20</option>
     </optgroup>
     <optgroup label="South West">
          <option value="K-6AUU-20">K-6AUU-20</option>
          <option value="K-6BGT-20">K-6BGT-20</option>
          <option value="X-6BGT-20">X-6BGT-20</option>
          <option value="X-6COI-01">X-6COI-01</option>
          <option value="K-6MJM-01">K-6MJM-01</option>
     </optgroup>
     <optgroup label="Wheatbelt">
          <option value="K-6CND-20">K-6CND-20</option>
          <option value="K-6NRG-20">K-6NRG-20</option>
          <option value="K-6SCR-20">K-6SCR-20</option>
     </optgroup>
        </select>

        <p>
        <label for="forecast-build-phase">Select the build phase you are working on for this SAM / Project</label>
        <select id="forecast-build-phase" name="forecast-build-phase" required onchange="showBuildPhaseContent()">
            <option value="">Select one</option>
            <option value="Design">Survey</option>
            <option value="Construction">Construction</option>
        </select></p>

        <!-- Design Phase Content -->
        <div id="design-content" class="phase-content" style="display: none;">
            <fieldset>
                <legend>Select the activity type(s) your company will be working on:</legend>
                <div class="discipline-checkbox-group">
                    <!-- Survey -->

                    <div>
                        <input type="checkbox" id="discipline-rod-and-rope" name="discipline[]" value="Rod and Rope" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-rod-and-rope">Rod and Rope</label>
                    </div>

                    <div id="discipline-rod-and-rope-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="rod-and-rope-crews">Number of Rod and Rope crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="rod-and-rope-crews" name="rod-and-rope-crews" min="0" step="1" />

                    <fieldset>
                        <legend>Select the day(s) that your Rod and Rope crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                        <div class="days-checkbox-group">
                        <div><input type="checkbox" id="rod-and-rope-monday" name="rod-and-rope-days[]" value="Monday" /><label for="rod-and-rope-monday">Monday</label></div>
    <div><input type="checkbox" id="rod-and-rope-tuesday" name="rod-and-rope-days[]" value="Tuesday" /><label for="rod-and-rope-tuesday">Tuesday</label></div>
    <div><input type="checkbox" id="rod-and-rope-wednesday" name="rod-and-rope-days[]" value="Wednesday" /><label for="rod-and-rope-wednesday">Wednesday</label></div>
    <div><input type="checkbox" id="rod-and-rope-thursday" name="rod-and-rope-days[]" value="Thursday" /><label for="rod-and-rope-thursday">Thursday</label></div>
    <div><input type="checkbox" id="rod-and-rope-friday" name="rod-and-rope-days[]" value="Friday" /><label for="rod-and-rope-friday">Friday</label></div>
    <div><input type="checkbox" id="rod-and-rope-saturday" name="rod-and-rope-days[]" value="Saturday" /><label for="rod-and-rope-saturday">Saturday</label></div>
    <div><input type="checkbox" id="rod-and-rope-sunday" name="rod-and-rope-days[]" value="Sunday" /><label for="rod-and-rope-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="rod-and-rope-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
</div>

                    <!-- Blockage Repair - Survey -->
                    <div>
                        <input type="checkbox" id="discipline-blockage-repair-survey" name="discipline[]" value="Blockage Repair-Survey" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-blockage-repair-survey">Blockage Repair - Survey</label>
                    </div>
                    <div id="discipline-blockage-repair-survey-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="blockage-repair-survey-crews">Number of Blockage crews (Survey) forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="blockage-repair-survey-crews" name="blockage-repair-survey-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your Blockage crews (Survey) are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="blockage-repair-survey-monday" name="blockage-repair-survey-days[]" value="Monday" /><label for="blockage-repair-survey-monday">Monday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-tuesday" name="blockage-repair-survey-days[]" value="Tuesday" /><label for="blockage-repair-survey-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-wednesday" name="blockage-repair-survey-days[]" value="Wednesday" /><label for="blockage-repair-survey-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-thursday" name="blockage-repair-survey-days[]" value="Thursday" /><label for="blockage-repair-survey-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-friday" name="blockage-repair-survey-days[]" value="Friday" /><label for="blockage-repair-survey-friday">Friday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-saturday" name="blockage-repair-survey-days[]" value="Saturday" /><label for="blockage-repair-survey-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="blockage-repair-survey-sunday" name="blockage-repair-survey-days[]" value="Sunday" /><label for="blockage-repair-survey-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="blockage-repair-survey-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>
                </div>
            </fieldset>
        </div>

        <!-- Construction Phase Content -->
        <div id="construction-content" class="phase-content" style="display: none;">
            <fieldset>
                <legend>Select the activity type(s) your company will be working on:</legend>
                <div class="discipline-checkbox-group">
                    <!-- Blockage Repair - Construction -->

                    <div>
                        <input type="checkbox" id="discipline-blockage-repair-construction" name="discipline[]" value="Blockage Repair-Construction" onchange="toggleDisciplineFields(this)" />
<label for="discipline-blockage-repair-construction">Blockage Repair - Construction</label>
                    </div>

                    <div id="discipline-blockage-repair-construction-fields" class="discipline-conditional-fields" style="display: none;">
    <label for="blockage-repair-construction-crews">Number of Blockage crews (Construction) forecast for next week (exclude Mob & Demob days):</label>
    <input type="number" id="blockage-repair-construction-crews" name="blockage-repair-construction-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Blockage crews (Construction) are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="blockage-repair-construction-monday" name="blockage-repair-construction-days[]" value="Monday" /><label for="blockage-repair-construction-monday">Monday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-tuesday" name="blockage-repair-construction-days[]" value="Tuesday" /><label for="blockage-repair-construction-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-wednesday" name="blockage-repair-construction-days[]" value="Wednesday" /><label for="blockage-repair-construction-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-thursday" name="blockage-repair-construction-days[]" value="Thursday" /><label for="blockage-repair-construction-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-friday" name="blockage-repair-construction-days[]" value="Friday" /><label for="blockage-repair-construction-friday">Friday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-saturday" name="blockage-repair-construction-days[]" value="Saturday" /><label for="blockage-repair-construction-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="blockage-repair-construction-sunday" name="blockage-repair-construction-days[]" value="Sunday" /><label for="blockage-repair-construction-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="blockage-repair-construction-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>
               
                    <!-- ACM Removal -->
                    <div>
                        <input type="checkbox" id="discipline-acm-removal" name="discipline[]" value="ACM Removal" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-acm-removal">ACM Removal</label>
                    </div>
                    <div id="discipline-acm-removal-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="acm-removal-crews">Number of ACM Removal crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="acm-removal-crews" name="acm-removal-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your ACM Removal crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="acm-removal-monday" name="acm-removal-days[]" value="Monday" /><label for="acm-removal-monday">Monday</label></div>
                                <div><input type="checkbox" id="acm-removal-tuesday" name="acm-removal-days[]" value="Tuesday" /><label for="acm-removal-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="acm-removal-wednesday" name="acm-removal-days[]" value="Wednesday" /><label for="acm-removal-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="acm-removal-thursday" name="acm-removal-days[]" value="Thursday" /><label for="acm-removal-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="acm-removal-friday" name="acm-removal-days[]" value="Friday" /><label for="acm-removal-friday">Friday</label></div>
                                <div><input type="checkbox" id="acm-removal-saturday" name="acm-removal-days[]" value="Saturday" /><label for="acm-removal-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="acm-removal-sunday" name="acm-removal-days[]" value="Sunday" /><label for="acm-removal-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="acm-removal-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Drilling -->
                    <div>
                        <input type="checkbox" id="discipline-drilling" name="discipline[]" value="Drilling" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-drilling">Drilling</label>
                    </div>
                    <div id="discipline-drilling-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="drilling-crews">Number of Drilling crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="drilling-crews" name="drilling-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your Drilling crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="drilling-monday" name="drilling-days[]" value="Monday" /><label for="drilling-monday">Monday</label></div>
                                <div><input type="checkbox" id="drilling-tuesday" name="drilling-days[]" value="Tuesday" /><label for="drilling-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="drilling-wednesday" name="drilling-days[]" value="Wednesday" /><label for="drilling-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="drilling-thursday" name="drilling-days[]" value="Thursday" /><label for="drilling-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="drilling-friday" name="drilling-days[]" value="Friday" /><label for="drilling-friday">Friday</label></div>
                                <div><input type="checkbox" id="drilling-saturday" name="drilling-days[]" value="Saturday" /><label for="drilling-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="drilling-sunday" name="drilling-days[]" value="Sunday" /><label for="drilling-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="drilling-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Trenching -->
                    <div>
                        <input type="checkbox" id="discipline-trenching" name="discipline[]" value="Trenching" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-trenching">Trenching</label>
                    </div>
                    <div id="discipline-trenching-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="trenching-crews">Number of Trenching crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="trenching-crews" name="trenching-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your Trenching crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="trenching-monday" name="trenching-days[]" value="Monday" /><label for="trenching-monday">Monday</label></div>
                                <div><input type="checkbox" id="trenching-tuesday" name="trenching-days[]" value="Tuesday" /><label for="trenching-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="trenching-wednesday" name="trenching-days[]" value="Wednesday" /><label for="trenching-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="trenching-thursday" name="trenching-days[]" value="Thursday" /><label for="trenching-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="trenching-friday" name="trenching-days[]" value="Friday" /><label for="trenching-friday">Friday</label></div>
                                <div><input type="checkbox" id="trenching-saturday" name="trenching-days[]" value="Saturday" /><label for="trenching-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="trenching-sunday" name="trenching-days[]" value="Sunday" /><label for="trenching-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="trenching-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Pit Installation/Remediation -->
                    <div>
                        <input type="checkbox" id="discipline-pit-installation-remediation" name="discipline[]" value="Pit Installation-Remediation" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-pit-installation-remediation">Pit Installation/Remediation</label>
                    </div>
                    <div id="discipline-pit-installation-remediation-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="pit-installation-remediation-crews">Number of Pit Installation/Remediation crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="pit-installation-remediation-crews" name="pit-installation-remediation-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your Trenching crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="pit-installation-remediation-monday" name="pit-installation-remediation-days[]" value="Monday" /><label for="pit-installation-remediation-monday">Monday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-tuesday" name="pit-installation-remediation-days[]" value="Tuesday" /><label for="pit-installation-remediation-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-wednesday" name="pit-installation-remediation-days[]" value="Wednesday" /><label for="pit-installation-remediation-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-thursday" name="pit-installation-remediation-days[]" value="Thursday" /><label for="pit-installation-remediation-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-friday" name="pit-installation-remediation-days[]" value="Friday" /><label for="pit-installation-remediation-friday">Friday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-saturday" name="pit-installation-remediation-days[]" value="Saturday" /><label for="pit-installation-remediation-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="pit-installation-remediation-sunday" name="pit-installation-remediation-days[]" value="Sunday" /><label for="pit-installation-remediation-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="pit-installation-remediation-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Reinstatement -->
                    <div>
                        <input type="checkbox" id="discipline-reinstatement" name="discipline[]" value="Reinstatement" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-reinstatement">Reinstatement</label>
                    </div>
                    <div id="discipline-reinstatement-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="reinstatement-crews">Number of Reinstatement crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="reinstatement-crews" name="reinstatement-crews" min="0" step="1" />
                        <fieldset>
                            <legend>Select the day(s) that your Reinstatement crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="reinstatement-monday" name="reinstatement-days[]" value="Monday" /><label for="reinstatement-monday">Monday</label></div>
                                <div><input type="checkbox" id="reinstatement-tuesday" name="reinstatement-days[]" value="Tuesday" /><label for="reinstatement-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="reinstatement-wednesday" name="reinstatement-days[]" value="Wednesday" /><label for="reinstatement-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="reinstatement-thursday" name="reinstatement-days[]" value="Thursday" /><label for="reinstatement-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="reinstatement-friday" name="reinstatement-days[]" value="Friday" /><label for="reinstatement-friday">Friday</label></div>
                                <div><input type="checkbox" id="reinstatement-saturday" name="reinstatement-days[]" value="Saturday" /><label for="reinstatement-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="reinstatement-sunday" name="reinstatement-days[]" value="Sunday" /><label for="reinstatement-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="reinstatement-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Cable Hauling -->
                    <div>
                        <input type="checkbox" id="discipline-cable-hauling" name="discipline[]" value="Cable Hauling" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-cable-hauling">Cable Hauling</label>
                    </div>
                    <div id="discipline-cable-hauling-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="cable-hauling-crews">Number of Cable Hauling crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="cable-hauling-crews" name="cable-hauling-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Cable Hauling crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="cable-hauling-monday" name="cable-hauling-days[]" value="Monday" /><label for="cable-hauling-monday">Monday</label></div>
                                <div><input type="checkbox" id="cable-hauling-tuesday" name="cable-hauling-days[]" value="Tuesday" /><label for="cable-hauling-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="cable-hauling-wednesday" name="cable-hauling-days[]" value="Wednesday" /><label for="cable-hauling-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="cable-hauling-thursday" name="cable-hauling-days[]" value="Thursday" /><label for="cable-hauling-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="cable-hauling-friday" name="cable-hauling-days[]" value="Friday" /><label for="cable-hauling-friday">Friday</label></div>
                                <div><input type="checkbox" id="cable-hauling-saturday" name="cable-hauling-days[]" value="Saturday" /><label for="cable-hauling-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="cable-hauling-sunday" name="cable-hauling-days[]" value="Sunday" /><label for="cable-hauling-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="cable-hauling-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Fibre Splicing -->
                    <div>
                        <input type="checkbox" id="discipline-fibre-splicing" name="discipline[]" value="Fibre Splicing" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-fibre-splicing">Fibre Splicing</label>
                    </div>
                    <div id="discipline-fibre-splicing-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="fibre-splicing-crews">Number of Fibre Splicing crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="fibre-splicing-crews" name="fibre-splicing-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Fibre Splicing crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="fibre-splicing-monday" name="fibre-splicing-days[]" value="Monday" /><label for="fibre-splicing-monday">Monday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-tuesday" name="fibre-splicing-days[]" value="Tuesday" /><label for="fibre-splicing-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-wednesday" name="fibre-splicing-days[]" value="Wednesday" /><label for="fibre-splicing-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-thursday" name="fibre-splicing-days[]" value="Thursday" /><label for="fibre-splicing-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-friday" name="fibre-splicing-days[]" value="Friday" /><label for="fibre-splicing-friday">Friday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-saturday" name="fibre-splicing-days[]" value="Saturday" /><label for="fibre-splicing-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="fibre-splicing-sunday" name="fibre-splicing-days[]" value="Sunday" /><label for="fibre-splicing-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="fibre-splicing-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Fibre Testing -->
                    <div>
                        <input type="checkbox" id="discipline-fibre-testing" name="discipline[]" value="Fibre Testing" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-fibre-testing">Fibre Testing</label>
                    </div>
                    <div id="discipline-fibre-testing-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="fibre-testing-crews">Number of Fibre Testing crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="fibre-testing-crews" name="fibre-testing-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Fibre Testing crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="fibre-testing-monday" name="fibre-testing-days[]" value="Monday" /><label for="fibre-testing-monday">Monday</label></div>
                                <div><input type="checkbox" id="fibre-testing-tuesday" name="fibre-testing-days[]" value="Tuesday" /><label for="fibre-testing-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="fibre-testing-wednesday" name="fibre-testing-days[]" value="Wednesday" /><label for="fibre-testing-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="fibre-testing-thursday" name="fibre-testing-days[]" value="Thursday" /><label for="fibre-testing-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="fibre-testing-friday" name="fibre-testing-days[]" value="Friday" /><label for="fibre-testing-friday">Friday</label></div>
                                <div><input type="checkbox" id="fibre-testing-saturday" name="fibre-testing-days[]" value="Saturday" /><label for="fibre-testing-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="fibre-testing-sunday" name="fibre-testing-days[]" value="Sunday" /><label for="fibre-testing-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="fibre-testing-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- PON Patching -->
                    <div>
                        <input type="checkbox" id="discipline-pon-patching" name="discipline[]" value="PON Patching" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-pon-patching">PON Patching</label>
                    </div>
                    <div id="discipline-pon-patching-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="pon-patching-crews">Number of PON Patching crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="pon-patching-crews" name="pon-patching-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your PON Patching crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="pon-patching-monday" name="pon-patching-days[]" value="Monday" /><label for="pon-patching-monday">Monday</label></div>
                                <div><input type="checkbox" id="pon-patching-tuesday" name="pon-patching-days[]" value="Tuesday" /><label for="pon-patching-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="pon-patching-wednesday" name="pon-patching-days[]" value="Wednesday" /><label for="pon-patching-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="pon-patching-thursday" name="pon-patching-days[]" value="Thursday" /><label for="pon-patching-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="pon-patching-friday" name="pon-patching-days[]" value="Friday" /><label for="pon-patching-friday">Friday</label></div>
                                <div><input type="checkbox" id="pon-patching-saturday" name="pon-patching-days[]" value="Saturday" /><label for="pon-patching-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="pon-patching-sunday" name="pon-patching-days[]" value="Sunday" /><label for="pon-patching-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="pon-patching-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Traffic Management -->
                    <div>
                        <input type="checkbox" id="discipline-traffic-management" name="discipline[]" value="Traffic Management" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-traffic-management">Traffic Management</label>
                    </div>
                    <div id="discipline-traffic-management-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="traffic-management-crews">Number of Traffic Management crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="traffic-management-crews" name="traffic-management-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Traffic Management crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="traffic-management-monday" name="traffic-management-days[]" value="Monday" /><label for="traffic-management-monday">Monday</label></div>
                                <div><input type="checkbox" id="traffic-management-tuesday" name="traffic-management-days[]" value="Tuesday" /><label for="traffic-management-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="traffic-management-wednesday" name="traffic-management-days[]" value="Wednesday" /><label for="traffic-management-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="traffic-management-thursday" name="traffic-management-days[]" value="Thursday" /><label for="traffic-management-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="traffic-management-friday" name="traffic-management-days[]" value="Friday" /><label for="traffic-management-friday">Friday</label></div>
                                <div><input type="checkbox" id="traffic-management-saturday" name="traffic-management-days[]" value="Saturday" /><label for="traffic-management-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="traffic-management-sunday" name="traffic-management-days[]" value="Sunday" /><label for="traffic-management-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="traffic-management-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Supervision -->
                    <div>
                        <input type="checkbox" id="discipline-supervision" name="discipline[]" value="Supervision" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-supervision">Supervision</label>
                    </div>
                    <div id="discipline-supervision-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="supervision-crews">Number of Supervision crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="supervision-crews" name="supervision-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Supervision crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="supervision-monday" name="supervision-days[]" value="Monday" /><label for="supervision-monday">Monday</label></div>
                                <div><input type="checkbox" id="supervision-tuesday" name="supervision-days[]" value="Tuesday" /><label for="supervision-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="supervision-wednesday" name="supervision-days[]" value="Wednesday" /><label for="supervision-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="supervision-thursday" name="supervision-days[]" value="Thursday" /><label for="supervision-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="supervision-friday" name="supervision-days[]" value="Friday" /><label for="supervision-friday">Friday</label></div>
                                <div><input type="checkbox" id="supervision-saturday" name="supervision-days[]" value="Saturday" /><label for="supervision-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="supervision-sunday" name="supervision-days[]" value="Sunday" /><label for="supervision-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="supervision-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>

                    <!-- Service Locating -->
                    <div>
                        <input type="checkbox" id="discipline-service-locating" name="discipline[]" value="Service Locating" onchange="toggleDisciplineFields(this)" />
                        <label for="discipline-service-locating">Service Locating</label>
                    </div>
                    <div id="discipline-service-locating-fields" class="discipline-conditional-fields" style="display: none;">
                        <label for="service-locating-crews">Number of Service Locating crews forecast for next week (exclude Mob & Demob days):</label>
                        <input type="number" id="service-locating-crews" name="service-locating-crews" min="0" step="1" />

                        <fieldset>
                            <legend>Select the day(s) that your Service Locating crews are forecast to be in the field next week (exclude Mob & Demob days):</legend>
                            <div class="days-checkbox-group">
                                <div><input type="checkbox" id="service-locating-monday" name="service-locating-days[]" value="Monday" /><label for="service-locating-monday">Monday</label></div>
                                <div><input type="checkbox" id="service-locating-tuesday" name="service-locating-days[]" value="Tuesday" /><label for="service-locating-tuesday">Tuesday</label></div>
                                <div><input type="checkbox" id="service-locating-wednesday" name="service-locating-days[]" value="Wednesday" /><label for="service-locating-wednesday">Wednesday</label></div>
                                <div><input type="checkbox" id="service-locating-thursday" name="service-locating-days[]" value="Thursday" /><label for="service-locating-thursday">Thursday</label></div>
                                <div><input type="checkbox" id="service-locating-friday" name="service-locating-days[]" value="Friday" /><label for="service-locating-friday">Friday</label></div>
                                <div><input type="checkbox" id="service-locating-saturday" name="service-locating-days[]" value="Saturday" /><label for="service-locating-saturday">Saturday</label></div>
                                <div><input type="checkbox" id="service-locating-sunday" name="service-locating-days[]" value="Sunday" /><label for="service-locating-sunday">Sunday</label></div>
                            </div>
                        </fieldset>
                        <p id="service-locating-days-error" class="discipline-days-error" style="color: red; display: none;">Please select at least one day.</p>
                    </div>
                </div>
            </fieldset>
<p id="discipline-error" style="color: red; display: none;">Please select at least one activity type.</p>
        </div>

            <div class="form-footer">
                <button type="button" class="btn-back" onclick="confirmReset('forecast')">Back</button>
                <button type="submit">Submit Forecast</button>
            </div>
        </form>
    </div>


    <div id="form-bog" class="form-section hidden">
      <h3>Daily Pre-Start: Boots on Ground: Genus N2P project</h3>
      <p>Please complete prior to starting work. <strong><u>Submission must be no later than 8am.</u></strong><br>This does not replace the JHA (JHA to be uploaded to IBISS - one required per site).</p>
      <form id="bog-form" onsubmit="validateBogForm()">

        <label for="bog-date">Date</label>
        <input type="date" id="bog-date" name="bog-date" required />

	<label for="bog-mob">
	<input type="checkbox" id="bog-mob" name="bog-mob" />
	Mobilisation Day
	</label>

	<label for="bog-demob">
	<input type="checkbox" id="bog-demob" name="bog-demob" />
	De-mobilisation Day
	</label>

        <label for="bog-company-name">Your Company Name</label>
        <select id="bog-company-name" name="bog-company-name" required>
          <option value="Boretech Contracting">Boretech Contracting</option>
          <option value="Connectit Communications">Connectit Communications</option>
          <option value="Dawn Techcomms">Dawn Techcomms</option>
          <option value="DDS Underground">DDS Underground</option>
          <option value="Dizza Communications">Dizza Communications</option>
          <option value="Djara Network Service">Djara Network Service</option>
          <option value="Feverpitch Enterprises">Feverpitch Enterprises</option>
          <option value="Genus Services" selected>Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="Lightsource">Lightsource</option>
          <option value="MNC Drilling">MNC Drilling</option>
          <option value="Netline Services">Netline Services</option>
          <option value="Syndicate Communications">Syndicate Communications</option>
          <option value="TAT Communications">TAT Communications</option>
          <option value="Versatile Services">Versatile Services</option>
        </select>

<!-- NEW: Estimated Start Time (Hour / Minutes / AM-PM) -->
<fieldset class="form-group time-group">
  <legend>Estimated Start Time</legend>
  <div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <!-- Hour -->
    <div style="flex: 1; min-width: 100px;">
      <label for="bog-start-hour">Hour</label>
      <select id="bog-start-hour" name="bog-start-hour" required>
        <option value="">Hour</option>
        <option value="1">01</option>
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
      </select>
    </div>
    <!-- Minutes -->
    <div style="flex: 1; min-width: 100px;">
      <label for="bog-start-minutes">Minutes</label>
      <select id="bog-start-minutes" name="bog-start-minutes" required>
        <option value="">Minutes</option>
        <option value="00">00</option>
        <option value="30">30</option>
      </select>
    </div>
    <!-- AM/PM -->
    <div style="flex: 1; min-width: 100px;">
      <label for="bog-start-ampm">AM/PM</label>
      <select id="bog-start-ampm" name="bog-start-ampm" required>
        <option value="">AM/PM</option>
        <option value="AM">AM</option>
        <option value="PM">PM</option>
      </select>
    </div>
  </div>
</fieldset>

<!-- NEW: Estimated Hours to be Worked Today -->
<div class="form-group">
  <label for="bog-estimated-hours">Estimated hours to be worked today</label>
  <select id="bog-estimated-hours" name="bog-estimated-hours" required>
    <option value="">Select hours</option>
    <option value="4">4</option>
    <option value="6">6</option>
    <option value="8">8</option>
    <option value="10">10</option>
    <option value="12">12</option>
  </select>
</div>

<!-- Keep these hidden fields if you still need ISO timestamps (optional; remove if not) -->
<input type="hidden" id="bog-estimated-start-timestamp" name="bog-estimated-start-timestamp" />
<input type="hidden" id="bog-estimated-finish-timestamp" name="bog-estimated-finish-timestamp" />
        
        <label for="bog-discipline">Discipline</label>
        <select id="bog-discipline" name="bog-discipline" required>
          <option value="">Select one</option>
     <optgroup label="Survey">
          <option value="Rod and Rope">Rod and Rope</option>
          <option value="Blockage Repair - Survey">Blockage Repair - Survey</option>
     </optgroup>
     <optgroup label="Construction">
          <option value="Blockage Repair - Construction">Blockage Repair - Construction</option>
          <option value="ACM Removal">ACM Removal</option>
          <option value="Drilling">Drilling</option>
          <option value="Trenching">Trenching</option>
          <option value="Service Locating">Service Locating</option>
          <option value="Pit Installation/Remediation">Pit Installation/Remediation</option>
          <option value="Reinstatement">Reinstatement</option>
          <option value="Cable Hauling">Cable Hauling</option>
          <option value="Fibre Splicing">Fibre Splicing</option>
          <option value="Fibre Testing">Fibre Testing</option>
          <option value="PON Patching">PON Patching</option>
          <option value="Traffic Management">Traffic Management</option>
          <option value="Supervision">Supervision</option>
     </optgroup>
        </select>

        <label for="bog-SAM">SAM ID</label>
        <select id="bog-SAM" name="bog-SAM" required>
          <option value="">Select one</option>
     <optgroup label="Gascoyne">
          <option value="K-6CVN-20">K-6CVN-20</option>
          <option value="K-6DNH-20">K-6DNH-20</option>
          <option value="K-6EXM-01">K-6EXM-01</option>
     </optgroup>
     <optgroup label="Goldfields-Esperance">
          <option value="K-6CGD-20">K-6CGD-20</option>
          <option value="K-6ESP-20">K-6ESP-20</option>
          <option value="K-6ESP-21">K-6ESP-21</option>
          <option value="K-6ESP-40">K-6ESP-40</option>
          <option value="K-6HOP-01">K-6HOP-01</option>
          <option value="K-6KAM-20">K-6KAM-20</option>
     </optgroup>
     <optgroup label="Great Southern">
          <option value="K-6ALN-22">K-6ALN-22</option>
          <option value="L-6ALN-05">L-6ALN-05</option>
          <option value="L-6ALN-20">L-6ALN-20</option>
          <option value="L-6ALN-21">L-6ALN-21</option>
          <option value="L-6ALN-23">L-6ALN-23</option>
          <option value="X-6ALN-05">X-6ALN-05</option>
          <option value="K-6DNK-20">K-6DNK-20</option>
          <option value="K-6KAT-20">K-6KAT-20</option>
     </optgroup>
     <optgroup label="Mid West">
          <option value="K-6KLB-01">K-6KLB-01</option>
          <option value="K-6LEA-20">K-6LEA-20</option>
     </optgroup>
     <optgroup label="Pilbara">
          <option value="K-6NWM-01">K-6NWM-01</option>
          <option value="K-6NWM-20">K-6NWM-20</option>
          <option value="K-6PDO-20">K-6PDO-20</option>
          <option value="K-6TPC-20">K-6TPC-20</option>
          <option value="X-6TPC-20">K-6TPC-20</option>
     </optgroup>
     <optgroup label="South West">
          <option value="K-6AUU-20">K-6AUU-20</option>
          <option value="K-6BGT-20">K-6BGT-20</option>
          <option value="X-6BGT-20">X-6BGT-20</option>
          <option value="X-6COI-01">X-6COI-01</option>
          <option value="K-6MJM-01">K-6MJM-01</option>
     </optgroup>
     <optgroup label="Wheatbelt">
          <option value="K-6CND-20">K-6CND-20</option>
          <option value="K-6NRG-20">K-6NRG-20</option>
          <option value="K-6SCR-20">K-6SCR-20</option>
     </optgroup>
        </select>

        <label for="bog-ADA">ADA ID</label>
        <select id="bog-ADA" name="bog-ADA" required>
          <option value="">Select one</option>
          <option value="01" data-sams="K-6AUU-20,K-6BGT-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,L-6ALN-20,X-6BGT-20,X-6TPC-20">01</option>
  <option value="02" data-sams="K-6AUU-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-20,L-6ALN-23,X-6BGT-20">02</option>
  <option value="03" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6ESP-40,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-21">03</option>
  <option value="04" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CND-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-20,K-6PDO-20,K-6TPC-20,L-6ALN-21">04</option>
  <option value="05" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-01,K-6TPC-20">05</option>
  <option value="06" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6TPC-20,L-6ALN-21,X-6COI-01">06</option>
  <option value="07" data-sams="K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6TPC-20">07</option>
  <option value="08" data-sams="K-6BGT-20,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NRG-20,L-6ALN-05,X-6TPC-20">08</option>
  <option value="09" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6KAT-20,K-6KLB-01,L-6ALN-20,X-6TPC-20">09</option>
  <option value="10" data-sams="K-6ALN-22,K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6HOP-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NWM-01,L-6ALN-20">10</option>
  <option value="11" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6MJM-01,K-6NRG-20,K-6NWM-01,L-6ALN-21">11</option>
  <option value="12" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-20">12</option>
  <option value="13" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-05">13</option>
  <option value="14" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NWM-01,L-6ALN-20,L-6ALN-21,X-6ALN-05">14</option>
  <option value="15" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,L-6ALN-23">15</option>
  <option value="16" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-21,X-6COI-01">16</option>
  <option value="17" data-sams="K-6ALN-22,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-23,X-6COI-01">17</option>
  <option value="18" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01">18</option>
  <option value="19" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6NWM-01,X-6COI-01">19</option>
  <option value="20" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6NWM-01">20</option>
  <option value="21" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-21,K-6NWM-01">21</option>
  <option value="22" data-sams="K-6CVN-20,K-6DNK-20,K-6MJM-01,K-6NWM-01">22</option>
  <option value="23" data-sams="K-6DNK-20,X-6COI-01">23</option>
  <option value="24" data-sams="K-6CVN-20,K-6DNK-20">24</option>
  <option value="25" data-sams="L-6ALN-20,L-6ALN-23">25</option>
  <option value="27" data-sams="L-6ALN-20">27</option>
  <option value="28" data-sams="L-6ALN-20">28</option>
  <option value="30" data-sams="L-6ALN-20">30</option>
  <option value="31" data-sams="L-6ALN-20">31</option>
        </select>

        <label for="bog-site-location">First Site Address</label>
        <input type="text" id="bog-site-location" name="bog-site-location" class="address-autocomplete" required />

    <label for="bog-site-contact">Onsite Crew Lead Name</label>
    <div id="bog-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="bog-site-contact-hidden" name="bog-site-contact" required />

        <label for="bog-onsite-crew-lead-mobile">Onsite Crew Lead Mobile</label>
        <input type="tel" id="bog-onsite-crew-lead-mobile" name="bog-onsite-crew-lead-mobile" pattern="04\d{8}" maxlength="10" placeholder="Enter 10-digit number" oninvalid="this.setCustomValidity('Enter number as 04xxxxxxxx')" oninput="this.setCustomValidity('')" required />

        <label for="bog-onsite-crew-lead-email">Onsite Crew Lead Email</label>
        <input type="text" id="bog-onsite-crew-lead-email" name="bog-onsite-crew-lead-email" />

        <label for="bog-onsite-crew-lead-EnableID">Onsite Crew Lead Enable ID (if applicable)</label>
        <input type="text" id="bog-onsite-crew-lead-EnableID" name="bog-onsite-crew-lead-EnableID" />
        
        <label for="bog-Number-of-People-at-Location">Number of People in Crew at Location</label>
        <input type="number" id="bog-Number-of-People-at-Location" name="bog-Number-of-People-at-Location" min="1" step="1" required>
        
    <label for="bog-crews-names">Select Crew Members</label>
    <div id="bog-crews-names" class="crew-checkbox">
      <p>Select crew members for this location...</p>
    </div>
    <input type="hidden" id="bog-crews-names-hidden" name="bog-crews-names" required />
       
        <label for="bog-Genus-FCM">Your Genus FCM</label>
        <select id="bog-Genus-FCM" name="bog-Genus-FCM" required>
          <option value="">Select one</option>
          <option value="Alex McConville">Alex McConville</option>
          <option value="Jason Curd">Jason Curd</option>
          <option value="Riaz Ejtahed">Riaz Ejtahed</option>
        </select>
<br><br>
<div>
  <fieldset id="bog-swms-fieldset">
    <legend><strong>Discipline with task Specific SWMS</strong></legend>
    <p>
      (SWMS-SHEQ-CMS-0011 Site Establishment, SWMS-SHEQ-CMS-0001 Access to Pits & Manholes - required on all sites, SWMS-SHEQ-CMS-0006 Asbestos (ACM) required for all ACM sites)
    </p>
    <p>All workers to have signed into Task SWMS being utilised with copy available - latest version.</p>

    <input type="checkbox" name="bog-SWMS[]" value="Scoping" /> Scoping (0017 Surveying & Scoping)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Trenching" /> Trenching (0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Drilling" /> Drilling (0016 Directional Boring, 0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Pit Installation" /> Pit Installation (0002 Installing Replacing Repairing Pits Manholes)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Hauling" /> Hauling (0008 Rod Roping & Cable Hauling)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Splicing" /> Splicing (0007 Cable Jointing)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Clear Blockage" /> Clear Blockage (0008 Rod Roping & Cable Hauling)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Service Locator" /> Service Locator (0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Reinstatement" /> Reinstatement (0012 Excavation & Trenching)<br />

    <p id="swms-error" style="color: red; display: none;">Please select at least one SWMS discipline.</p>
  </fieldset>
</div>
                
<div id="bog-swms-section">
  <id="bog-jha-label">
    <label for="bog-jha-uploaded">
      I confirm all workers have been inducted and have signed onto the JHA.
    </label>
    <input type="checkbox" id="bog-jha-uploaded" name="bog-jha-uploaded" required>
    Please induct all visitors to JHA and complete prior to starting at each site.
  </div>

        <label for="bog-ACM">Will you be disturbing/modifying any possible ACM while onsite?</label>
        <select id="bog-ACM" name="bog-ACM" onchange="toggleACMField()" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

<!-- Conditional Field -->
<div id="bog-acm-notification-field" style="display: none; margin-top: 10px;">
  <label for="bog-acm-yes">If yes, have you received your Genus ACM Removal Notification Code and placed on your Construction</label>
  Required for all ACM Pit replacement work, with Company Class B, worker to have remove Non-Friable accreditation with ACM supervisor in the vicinity.<br />
  <select id="bog-acm-yes" name="bog-acm-yes">
          <option value="">Select one</option>
          <option value="Yes">Yes, continue</option>
          <option value="No">No, stop work and contact your Genus FCM</option>
        </select>
</div>
                
<div id="bog-guards">
  <label for="bog-guards-checkbox">Are appropriate gas monitoring and trench guards in place?</label>
  <input type="checkbox" id="bog-guards-checkbox" name="bog-guards" /> Refer to HSE Guidance Note - Spot Sampling (Manhole) Gas Action Chart.
</div> 
               
<div id="bog-excavation">
  <label for="bog-excavation-checkbox">Is excavation work being conducted today?</label>
  <input type="checkbox" id="bog-excavation-checkbox" name="bog-excavation" /> Refer to HSE Guidance Note  Construction JHA and Excavation permit process
</div>        

        <label for="bog-comments">Additional Comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
        <textarea id="bog-comments" name="bog-comments" placeholder="Track required actions in MyOsh with SHEQ support"></textarea>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('bog')">Back</button>
          <button type="submit">Submit BOG</button>
        </div>
      </form>
    </div>

    <div id="form-reinstatement" class="form-section hidden">
      <h3>Reinstatement Register: Genus N2P project</h3>
      <p>Please complete for any temporary reinstatement works.</p>
      <form id="reinstatement-form">

<label for="reinstatement-note-id-search">Search Note ID</label>
<div style="display: flex; gap: 0.5rem; align-items: center;">
  <input type="text" id="reinstatement-note-id-search" placeholder="Enter Note ID" />
  <button type="button" id="reinstatement-search-btn" class="search-btn">Search</button>
</div>

<!-- Optional read-only summary or error display -->
<div id="reinstatement-note-summary" style="margin-top: 1rem; font-weight: bold;"></div>

<!-- OR Divider -->
<div class="or-divider">
  <hr class="line" />
  <span class="or-text">OR</span>
  <hr class="line" />
</div>


	<!-- Hidden input hardcoded to 'Reinstatement' -->
	<input type="hidden" id="reinstatement-type" name="reinstatement-type" value="Reinstatement">

        <label for="reinstatement-company-name">Temp Contractor Company Name</label>
        <select id="reinstatement-company-name" name="reinstatement-company-name" required>
          <option value="Boretech Contracting">Boretech Contracting</option>
          <option value="Connectit Communications">Connectit Communications</option>
          <option value="Dawn Techcomms">Dawn Techcomms</option>
          <option value="DDS Underground">DDS Underground</option>
          <option value="Dizza Communications">Dizza Communications</option>
          <option value="Djara Network Service">Djara Network Service</option>
          <option value="Feverpitch Enterprises">Feverpitch Enterprises</option>
          <option value="Genus Services" selected>Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="Lightsource">Lightsource</option>
          <option value="MNC Drilling">MNC Drilling</option>
          <option value="Netline Services">Netline Services</option>
          <option value="Syndicate Communications">Syndicate Communications</option>
          <option value="TAT Communications">TAT Communications</option>
          <option value="Versatile Services">Versatile Services</option>
        </select>

    <label for="reinstatement-site-contact">Crew Lead Contact Name</label>
    <div id="reinstatement-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="reinstatement-site-contact-hidden" name="reinstatement-site-contact" required />

        <label for="reinstatement-date">Temp Reinstatement Date</label>
        <input type="date" id="reinstatement-date" name="reinstatement-date" required />

        <label for="reinstatement-SAM">SAM ID</label>
        <select id="reinstatement-SAM" name="reinstatement-SAM" required>
          <option value="">Select one</option>
     <optgroup label="Gascoyne">
          <option value="K-6CVN-20">K-6CVN-20</option>
          <option value="K-6DNH-20">K-6DNH-20</option>
          <option value="K-6EXM-01">K-6EXM-01</option>
     </optgroup>
     <optgroup label="Goldfields-Esperance">
          <option value="K-6CGD-20">K-6CGD-20</option>
          <option value="K-6ESP-20">K-6ESP-20</option>
          <option value="K-6ESP-21">K-6ESP-21</option>
          <option value="K-6ESP-40">K-6ESP-40</option>
          <option value="K-6HOP-01">K-6HOP-01</option>
          <option value="K-6KAM-20">K-6KAM-20</option>
     </optgroup>
     <optgroup label="Great Southern">
          <option value="K-6ALN-22">K-6ALN-22</option>
          <option value="L-6ALN-05">L-6ALN-05</option>
          <option value="L-6ALN-20">L-6ALN-20</option>
          <option value="L-6ALN-21">L-6ALN-21</option>
          <option value="L-6ALN-23">L-6ALN-23</option>
          <option value="X-6ALN-05">X-6ALN-05</option>
          <option value="K-6DNK-20">K-6DNK-20</option>
          <option value="K-6KAT-20">K-6KAT-20</option>
     </optgroup>
     <optgroup label="Mid West">
          <option value="K-6KLB-01">K-6KLB-01</option>
          <option value="K-6LEA-20">K-6LEA-20</option>
     </optgroup>
     <optgroup label="Pilbara">
          <option value="K-6NWM-01">K-6NWM-01</option>
          <option value="K-6NWM-20">K-6NWM-20</option>
          <option value="K-6PDO-20">K-6PDO-20</option>
          <option value="K-6TPC-20">K-6TPC-20</option>
          <option value="X-6TPC-20">K-6TPC-20</option>
     </optgroup>
     <optgroup label="South West">
          <option value="K-6AUU-20">K-6AUU-20</option>
          <option value="K-6BGT-20">K-6BGT-20</option>
          <option value="X-6BGT-20">X-6BGT-20</option>
          <option value="X-6COI-01">X-6COI-01</option>
          <option value="K-6MJM-01">K-6MJM-01</option>
     </optgroup>
     <optgroup label="Wheatbelt">
          <option value="K-6CND-20">K-6CND-20</option>
          <option value="K-6NRG-20">K-6NRG-20</option>
          <option value="K-6SCR-20">K-6SCR-20</option>
     </optgroup>
        </select>

        <label for="reinstatement-ADA">ADA ID</label>
        <select id="reinstatement-ADA" name="reinstatement-ADA" required>
          <option value="">Select one</option>
          <option value="01" data-sams="K-6AUU-20,K-6BGT-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,L-6ALN-20,X-6BGT-20,X-6TPC-20">01</option>
  <option value="02" data-sams="K-6AUU-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-20,L-6ALN-23,X-6BGT-20">02</option>
  <option value="03" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6ESP-40,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-21">03</option>
  <option value="04" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CND-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-20,K-6PDO-20,K-6TPC-20,L-6ALN-21">04</option>
  <option value="05" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-01,K-6TPC-20">05</option>
  <option value="06" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6TPC-20,L-6ALN-21,X-6COI-01">06</option>
  <option value="07" data-sams="K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6TPC-20">07</option>
  <option value="08" data-sams="K-6BGT-20,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NRG-20,L-6ALN-05,X-6TPC-20">08</option>
  <option value="09" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6KAT-20,K-6KLB-01,L-6ALN-20,X-6TPC-20">09</option>
  <option value="10" data-sams="K-6ALN-22,K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6HOP-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NWM-01,L-6ALN-20">10</option>
  <option value="11" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6MJM-01,K-6NRG-20,K-6NWM-01,L-6ALN-21">11</option>
  <option value="12" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-20">12</option>
  <option value="13" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-05">13</option>
  <option value="14" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NWM-01,L-6ALN-20,L-6ALN-21,X-6ALN-05">14</option>
  <option value="15" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,L-6ALN-23">15</option>
  <option value="16" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-21,X-6COI-01">16</option>
  <option value="17" data-sams="K-6ALN-22,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-23,X-6COI-01">17</option>
  <option value="18" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01">18</option>
  <option value="19" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6NWM-01,X-6COI-01">19</option>
  <option value="20" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6NWM-01">20</option>
  <option value="21" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-21,K-6NWM-01">21</option>
  <option value="22" data-sams="K-6CVN-20,K-6DNK-20,K-6MJM-01,K-6NWM-01">22</option>
  <option value="23" data-sams="K-6DNK-20,X-6COI-01">23</option>
  <option value="24" data-sams="K-6CVN-20,K-6DNK-20">24</option>
  <option value="25" data-sams="L-6ALN-20,L-6ALN-23">25</option>
  <option value="27" data-sams="L-6ALN-20">27</option>
  <option value="28" data-sams="L-6ALN-20">28</option>
  <option value="30" data-sams="L-6ALN-20">30</option>
  <option value="31" data-sams="L-6ALN-20">31</option>
        </select>

        <label for="reinstatement-address">Address of Reinstatement</label>
        <input type="text" id="reinstatement-address" name="reinstatement-address" class="address-autocomplete" required />

        <label for="reinstatement-Pit-Note-ID">Pit Note ID:</label>
        <input type="text" id="reinstatement-Pit-Note-ID" name="reinstatement-Pit-Note-ID" required />


        <label for="reinstatement-asset-type">Asset Type</label>
        <select id="reinstatement-asset-type" name="reinstatement-asset-type" required>
          <option value="">Select one</option>
          <option value="Duct - P50">Duct - P50</option>
          <option value="Pits - P5">Pits - P5</option>
          <option value="Pits - P6">Pits - P6</option>
          <option value="Pits - P8">Pits - P8</option>
        </select>

        <label for="reinstatement-surface-type">Surface Type</label>
        <select id="reinstatement-surface-type" name="reinstatement-surface-type" onchange="toggleSurfaceTypeField()" required>
          <option value="">Select one</option>
          <option value="Aggregate">Aggregate</option>
          <option value="Bitumen">Bitumen</option>
          <option value="Concrete">Concrete</option>
          <option value="Cracker Dust">Cracker Dust</option>
          <option value="Gravel">Gravel</option>
          <option value="Limestone">Limestone</option>
          <option value="Paved">Paved</option>
          <option value="Other">Other</option>
        </select>

        <!-- Conditional Field -->
<div id="reinstatement-surface-type-notification-field" style="display: none; margin-top: 10px;">
  <label for="reinstatement-surface-type-other">Surface Type - Other</label>
<input type="text" id="reinstatement-surface-type-other" name="reinstatement-surface-type-other" />
</div>

        <label for="reinstatement-location-type">Location Type</label>
        <select id="reinstatement-location-type" name="reinstatement-location-type" onchange="toggleLocationTypeField()" required>
          <option value="">Select one</option>
          <option value="Driveway">Driveway</option>
          <option value="Footpath">Footpath</option>
          <option value="Roadway">Roadway</option>
          <option value="Other">Other</option>
        </select>

        <!-- Conditional Field -->
<div id="reinstatement-location-type-notification-field" style="display: none; margin-top: 10px;">
  <label for="reinstatement-location-type-other">Location Type - Other</label>
<input type="text" id="reinstatement-location-type-other" name="reinstatement-location-type-other" />
</div>

        <label for="reinstatement-material-type">Temp Material Used</label>
        <select id="reinstatement-material-type" name="reinstatement-material-type" onchange="toggleMaterialTypeField()" required>
          <option value="">Select one</option>
          <option value="Cold Mix">Cold Mix</option>
          <option value="Cracker Dust">Cracker Dust</option>
          <option value="Gravel / Sand">Gravel / Sand</option>
          <option value="Other">Other</option>
        </select>

        <!-- Conditional Field -->
<div id="reinstatement-material-type-notification-field" style="display: none; margin-top: 10px;">
  <label for="reinstatement-material-type-other">Temp Material Used - Other</label>
<input type="text" id="reinstatement-material-type-other" name="reinstatement-material-type-other" />
</div>

        <label for="reinstatement-area">Permanent Reinstatement Area (m2)</label>
        <select id="reinstatement-area" name="reinstatement-area" required>
          <option value="">Select one</option>
          <option value="Less than or equal to 3m2">Less than or equal to 3m2</option>
          <option value="Greater than 3m2">Greater than 3m2</option>
        </select>

        <label for="reinstatement-panel">Full Panel Required?</label>
        <select id="reinstatement-panel" name="reinstatement-panel" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>        

        <label for="reinstatement-perm-date">Proposed Permanent Reinstatement Date</label>
        <input type="date" id="reinstatement-perm-date" name="reinstatement-perm-date" required />

        <label for="reinstatement-perm-company-name">Permanent Reinstatement Contractor Company Name</label>
        <select id="reinstatement-perm-company-name" name="reinstatement-perm-company-name" required>
          <option value="">Select one</option>
          <option value="Boretech Contracting">Boretech Contracting</option>
          <option value="Connectit Communications">Connectit Communications</option>
          <option value="Dawn Techcomms">Dawn Techcomms</option>
          <option value="DDS Underground">DDS Underground</option>
          <option value="Dizza Communications">Dizza Communications</option>
          <option value="Djara Network Service">Djara Network Service</option>
          <option value="Feverpitch Enterprises">Feverpitch Enterprises</option>
          <option value="Genus Services">Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="Lightsource">Lightsource</option>
          <option value="MNC Drilling">MNC Drilling</option>
          <option value="Netline Services">Netline Services</option>
          <option value="Syndicate Communications">Syndicate Communications</option>
          <option value="TAT Communications">TAT Communications</option>
          <option value="Versatile Services">Versatile Services</option>
        </select>

        <label for="reinstatement-perm-material">Permanent Reinstatement Material Type</label>
        <select id="reinstatement-perm-material" name="reinstatement-perm-material" onchange="togglePermMaterialTypeField()" required>
          <option value="">Select one</option>
          <option value="Aggregate">Aggregate</option>
          <option value="Bitumen">Bitumen</option>
          <option value="Bitumen-Red">Bitumen - Red</option>
          <option value="Concrete">Concrete</option>
          <option value="Cracker Dust">Cracker Dust</option>
          <option value="Gravel">Gravel</option>
          <option value="Limestone">Limestone</option>
          <option value="Paved">Paved</option>
          <option value="Other">Other</option>
        </select>

        <!-- Conditional Field -->
<div id="reinstatement-perm-material-notification-field" style="display: none; margin-top: 10px;">
  <label for="reinstatement-perm-material-other">Permanent Reinstatement Material Used - Other</label>
<input type="text" id="reinstatement-perm-material-other" name="reinstatement-perm-material-other" />
</div>

	<label>
	<input type="checkbox" id="reinstatement-Non-Standard" name="reinstatement-Non-Standard" />
	Was this a non-standard Permanent Reinstatement?
	</label>

        <label for="reinstatement-comments">Any additional comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
        <textarea id="reinstatement-comments" name="reinstatement-comments" placeholder="If there are no additional comments, there is no need to enter anything here"></textarea>

	<label>
	<input type="checkbox" id="reinstatement-completed" name="reinstatement-completed" />
	Permanent Reinstatement Completed
	</label>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('reinstatement')">Back</button>
          <button type="submit" id="reinstatement-submit-btn">Submit Reinstatement</button>
        </div>
      </form>
    </div>

    <div id="form-pitlinkin" class="form-section hidden">
      <h3>Pit Link-in Register: Genus N2P project</h3>
      <p>Please complete for any pit link-in's required to be done by another contractor.</p>
      <form id="pitlinkin-form" onsubmit="return validateGenericForm('pitlinkin-form')">

<label for="pitlinkin-note-id-search">Search Duct Note ID</label>
<div style="display: flex; gap: 0.5rem; align-items: center;">
  <input type="text" id="pitlinkin-note-id-search" placeholder="Enter Note ID" />
  <button type="button" id="pitlinkin-search-btn" class="search-btn">Search</button>
</div>

<!-- Optional read-only summary or error display -->
<div id="pitlinkin-note-summary" style="margin-top: 1rem; font-weight: bold;"></div>

<!-- OR Divider -->
<div class="or-divider">
  <hr class="line" />
  <span class="or-text">OR</span>
  <hr class="line" />
</div>

	<!-- Hidden input hardcoded to 'Pit Link-in' -->
	<input type="hidden" id="pitlinkin-type" name="pitlinkin-type" value="Pit Link-in">

    <label for="pitlinkin-site-contact">Crew Lead Contact Name</label>
    <div id="pitlinkin-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="pitlinkin-site-contact-hidden" name="pitlinkin-site-contact" required />

        <label for="pitlinkin-date">Date Reported</label>
        <input type="date" id="pitlinkin-date" name="pitlinkin-date" required />

        <label for="pitlinkin-SAM">SAM ID</label>
        <select id="pitlinkin-SAM" name="pitlinkin-SAM" required>
          <option value="">Select one</option>
     <optgroup label="Gascoyne">
          <option value="K-6CVN-20">K-6CVN-20</option>
          <option value="K-6DNH-20">K-6DNH-20</option>
          <option value="K-6EXM-01">K-6EXM-01</option>
     </optgroup>
     <optgroup label="Goldfields-Esperance">
          <option value="K-6CGD-20">K-6CGD-20</option>
          <option value="K-6ESP-20">K-6ESP-20</option>
          <option value="K-6ESP-21">K-6ESP-21</option>
          <option value="K-6ESP-40">K-6ESP-40</option>
          <option value="K-6HOP-01">K-6HOP-01</option>
          <option value="K-6KAM-20">K-6KAM-20</option>
     </optgroup>
     <optgroup label="Great Southern">
          <option value="K-6ALN-22">K-6ALN-22</option>
          <option value="L-6ALN-05">L-6ALN-05</option>
          <option value="L-6ALN-20">L-6ALN-20</option>
          <option value="L-6ALN-21">L-6ALN-21</option>
          <option value="L-6ALN-23">L-6ALN-23</option>
          <option value="X-6ALN-05">X-6ALN-05</option>
          <option value="K-6DNK-20">K-6DNK-20</option>
          <option value="K-6KAT-20">K-6KAT-20</option>
     </optgroup>
     <optgroup label="Mid West">
          <option value="K-6KLB-01">K-6KLB-01</option>
          <option value="K-6LEA-20">K-6LEA-20</option>
     </optgroup>
     <optgroup label="Pilbara">
          <option value="K-6NWM-01">K-6NWM-01</option>
          <option value="K-6NWM-20">K-6NWM-20</option>
          <option value="K-6PDO-20">K-6PDO-20</option>
          <option value="K-6TPC-20">K-6TPC-20</option>
          <option value="X-6TPC-20">K-6TPC-20</option>
     </optgroup>
     <optgroup label="South West">
          <option value="K-6AUU-20">K-6AUU-20</option>
          <option value="K-6BGT-20">K-6BGT-20</option>
          <option value="X-6BGT-20">X-6BGT-20</option>
          <option value="X-6COI-01">X-6COI-01</option>
          <option value="K-6MJM-01">K-6MJM-01</option>
     </optgroup>
     <optgroup label="Wheatbelt">
          <option value="K-6CND-20">K-6CND-20</option>
          <option value="K-6NRG-20">K-6NRG-20</option>
          <option value="K-6SCR-20">K-6SCR-20</option>
     </optgroup>
        </select>

        <label for="pitlinkin-ADA">ADA ID</label>
        <select id="pitlinkin-ADA" name="pitlinkin-ADA" required>
          <option value="">Select one</option>
          <option value="01" data-sams="K-6AUU-20,K-6BGT-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,L-6ALN-20,X-6BGT-20,X-6TPC-20">01</option>
  <option value="02" data-sams="K-6AUU-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-20,L-6ALN-23,X-6BGT-20">02</option>
  <option value="03" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6ESP-40,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-21">03</option>
  <option value="04" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CND-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-20,K-6PDO-20,K-6TPC-20,L-6ALN-21">04</option>
  <option value="05" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-01,K-6TPC-20">05</option>
  <option value="06" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6TPC-20,L-6ALN-21,X-6COI-01">06</option>
  <option value="07" data-sams="K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6TPC-20">07</option>
  <option value="08" data-sams="K-6BGT-20,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NRG-20,L-6ALN-05,X-6TPC-20">08</option>
  <option value="09" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6KAT-20,K-6KLB-01,L-6ALN-20,X-6TPC-20">09</option>
  <option value="10" data-sams="K-6ALN-22,K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6HOP-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NWM-01,L-6ALN-20">10</option>
  <option value="11" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6MJM-01,K-6NRG-20,K-6NWM-01,L-6ALN-21">11</option>
  <option value="12" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-20">12</option>
  <option value="13" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-05">13</option>
  <option value="14" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NWM-01,L-6ALN-20,L-6ALN-21,X-6ALN-05">14</option>
  <option value="15" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,L-6ALN-23">15</option>
  <option value="16" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-21,X-6COI-01">16</option>
  <option value="17" data-sams="K-6ALN-22,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-23,X-6COI-01">17</option>
  <option value="18" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01">18</option>
  <option value="19" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6NWM-01,X-6COI-01">19</option>
  <option value="20" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6NWM-01">20</option>
  <option value="21" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-21,K-6NWM-01">21</option>
  <option value="22" data-sams="K-6CVN-20,K-6DNK-20,K-6MJM-01,K-6NWM-01">22</option>
  <option value="23" data-sams="K-6DNK-20,X-6COI-01">23</option>
  <option value="24" data-sams="K-6CVN-20,K-6DNK-20">24</option>
  <option value="25" data-sams="L-6ALN-20,L-6ALN-23">25</option>
  <option value="27" data-sams="L-6ALN-20">27</option>
  <option value="28" data-sams="L-6ALN-20">28</option>
  <option value="30" data-sams="L-6ALN-20">30</option>
  <option value="31" data-sams="L-6ALN-20">31</option>
        </select>

        <label for="pitlinkin-Duct-Note-ID">Duct Note ID:</label>
        <input type="text" id="pitlinkin-Duct-Note-ID" name="pitlinkin-Duct-Note-ID" required />
                
    <label for="pitlinkin-PitA-linkin-required">Pit A Link-in Required?</label>
    <input type="checkbox" id="pitlinkin-PitA-linkin-required" name="pitlinkin-PitA-linkin-required">

    <label for="pitlinkin-PitA-Note-ID">Pit A Note ID:</label>
    <input type="text" id="pitlinkin-PitA-Note-ID" name="pitlinkin-PitA-Note-ID" required>

        <label for="pitlinkin-PitA-ffp">Is Pit A Fit for Purpose</label>
        <select id="pitlinkin-PitA-ffp" name="pitlinkin-PitA-ffp" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No - Contact FCM">No - Contact FCM</option>
        </select>

    <label for="pitlinkin-PitB-linkin-required">Pit B Link-in Required?</label>
    <input type="checkbox" id="pitlinkin-PitB-linkin-required" name="pitlinkin-PitB-linkin-required">
 
    <label for="pitlinkin-PitB-Note-ID">Pit B Note ID:</label>
    <input type="text" id="pitlinkin-PitB-Note-ID" name="pitlinkin-PitB-Note-ID" required>
 
        <label for="pitlinkin-PitB-ffp">Is Pit B Fit for Purpose</label>
        <select id="pitlinkin-PitB-ffp" name="pitlinkin-PitB-ffp" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No - Contact FCM">No - Contact FCM</option>
        </select>

        <label for="pitlinkin-rrp">RRP Completed?</label>
        <select id="pitlinkin-rrp" name="pitlinkin-rrp" onchange="toggleRRPCompleteField()" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

        <!-- Conditional Field -->
<div id="pitlinkin-rrp-notification-field" style="display: none; margin-top: 10px;">
  <label for="pitlinkin-rrp-no">What is the reason RRP has not been completed?</label>
<select id="pitlinkin-rrp-no" name="pitlinkin-rrp-no">
          <option value="">Select one</option>
          <option value="Weather">Weather</option>
          <option value="Material">Material Shortage</option>
          <option value="Other">Other Reasons (add in "Additional Comments" section of this form)</option>
        </select>
        
</div>

        <label for="pitlinkin-comments">Any additional comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
        <textarea id="pitlinkin-comments" name="pitlinkin-comments" placeholder="If there are no additional comments, there is no need to enter anything here"></textarea>

<label>
  <input type="checkbox" id="pitlinkin-completed" name="pitlinkin-completed" />
  I confirm RRP and Link-in's for this NoteID are now completed
</label>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('pitlinkin')">Back</button>
          <button type="submit" id="pitlinkin-submit-btn">Submit Pit Link-in</button>
        </div>
      </form>
    </div>

    <div id="form-vactruck" class="form-section hidden">
      <h3>Vac Truck Register: Genus N2P project</h3>
      <form id="vactruck-form" onsubmit="return validateGenericForm('vactruck-form')">

<label for="vactruck-note-id-search">Search Pit Note ID</label>
<div style="display: flex; gap: 0.5rem; align-items: center;">
  <input type="text" id="vactruck-note-id-search" placeholder="Enter Note ID" />
  <button type="button" id="vactruck-search-btn" class="search-btn">Search</button>
</div>

<!-- Optional read-only summary or error display -->
<div id="vactruck-note-summary" style="margin-top: 1rem; font-weight: bold;"></div>

<!-- OR Divider -->
<div class="or-divider">
  <hr class="line" />
  <span class="or-text">OR</span>
  <hr class="line" />
</div>

	<!-- Hidden input hardcoded to 'Vac Truck' -->
	<input type="hidden" id="vactruck-type" name="vactruck-type" value="Vac Truck">

        <label for="vactruck-company-name">Your Company Name</label>
          <select id="vactruck-company-name" name="vactruck-company-name" required>
          <option value="Boretech Contracting">Boretech Contracting</option>
          <option value="Connectit Communications">Connectit Communications</option>
          <option value="Dawn Techcomms">Dawn Techcomms</option>
          <option value="DDS Underground">DDS Underground</option>
          <option value="Dizza Communications">Dizza Communications</option>
          <option value="Djara Network Service">Djara Network Service</option>
          <option value="Feverpitch Enterprises">Feverpitch Enterprises</option>
          <option value="Genus Services" selected>Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="Lightsource">Lightsource</option>
          <option value="MNC Drilling">MNC Drilling</option>
          <option value="Netline Services">Netline Services</option>
          <option value="Syndicate Communications">Syndicate Communications</option>
          <option value="TAT Communications">TAT Communications</option>
          <option value="Versatile Services">Versatile Services</option>
        </select>
        

        <label for="vactruck-date">Date Idendified</label>
        <input type="date" id="vactruck-date" name="vactruck-date" required />

        <label for="vactruck-SAM">SAM ID</label>
        <select id="vactruck-SAM" name="vactruck-SAM" required>
          <option value="">Select one</option>
     <optgroup label="Gascoyne">
          <option value="K-6CVN-20">K-6CVN-20</option>
          <option value="K-6DNH-20">K-6DNH-20</option>
          <option value="K-6EXM-01">K-6EXM-01</option>
     </optgroup>
     <optgroup label="Goldfields-Esperance">
          <option value="K-6CGD-20">K-6CGD-20</option>
          <option value="K-6ESP-20">K-6ESP-20</option>
          <option value="K-6ESP-21">K-6ESP-21</option>
          <option value="K-6ESP-40">K-6ESP-40</option>
          <option value="K-6HOP-01">K-6HOP-01</option>
          <option value="K-6KAM-20">K-6KAM-20</option>
     </optgroup>
     <optgroup label="Great Southern">
          <option value="K-6ALN-22">K-6ALN-22</option>
          <option value="L-6ALN-05">L-6ALN-05</option>
          <option value="L-6ALN-20">L-6ALN-20</option>
          <option value="L-6ALN-21">L-6ALN-21</option>
          <option value="L-6ALN-23">L-6ALN-23</option>
          <option value="X-6ALN-05">X-6ALN-05</option>
          <option value="K-6DNK-20">K-6DNK-20</option>
          <option value="K-6KAT-20">K-6KAT-20</option>
     </optgroup>
     <optgroup label="Mid West">
          <option value="K-6KLB-01">K-6KLB-01</option>
          <option value="K-6LEA-20">K-6LEA-20</option>
     </optgroup>
     <optgroup label="Pilbara">
          <option value="K-6NWM-01">K-6NWM-01</option>
          <option value="K-6NWM-20">K-6NWM-20</option>
          <option value="K-6PDO-20">K-6PDO-20</option>
          <option value="K-6TPC-20">K-6TPC-20</option>
          <option value="X-6TPC-20">K-6TPC-20</option>
     </optgroup>
     <optgroup label="South West">
          <option value="K-6AUU-20">K-6AUU-20</option>
          <option value="K-6BGT-20">K-6BGT-20</option>
          <option value="X-6BGT-20">X-6BGT-20</option>
          <option value="X-6COI-01">X-6COI-01</option>
          <option value="K-6MJM-01">K-6MJM-01</option>
     </optgroup>
     <optgroup label="Wheatbelt">
          <option value="K-6CND-20">K-6CND-20</option>
          <option value="K-6NRG-20">K-6NRG-20</option>
          <option value="K-6SCR-20">K-6SCR-20</option>
     </optgroup>
        </select>

        <label for="vactruck-ADA">ADA ID</label>
        <select id="vactruck-ADA" name="vactruck-ADA" required>
          <option value="">Select one</option>
          <option value="01" data-sams="K-6AUU-20,K-6BGT-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,L-6ALN-20,X-6BGT-20,X-6TPC-20">01</option>
  <option value="02" data-sams="K-6AUU-20,K-6CGD-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-20,L-6ALN-23,X-6BGT-20">02</option>
  <option value="03" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6ESP-40,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6NWM-01,K-6NWM-20,K-6PDO-20,K-6SCR-20,K-6TPC-20,L-6ALN-21">03</option>
  <option value="04" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CND-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-20,K-6PDO-20,K-6TPC-20,L-6ALN-21">04</option>
  <option value="05" data-sams="K-6AUU-20,K-6BGT-20,K-6CND-20,K-6CVN-20,K-6DNH-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NWM-01,K-6TPC-20">05</option>
  <option value="06" data-sams="K-6ALN-22,K-6AUU-20,K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAT-20,K-6KLB-01,K-6LEA-20,K-6MJM-01,K-6TPC-20,L-6ALN-21,X-6COI-01">06</option>
  <option value="07" data-sams="K-6BGT-20,K-6CVN-20,K-6DNH-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KLB-01,K-6LEA-20,K-6NRG-20,K-6TPC-20">07</option>
  <option value="08" data-sams="K-6BGT-20,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NRG-20,L-6ALN-05,X-6TPC-20">08</option>
  <option value="09" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6KAT-20,K-6KLB-01,L-6ALN-20,X-6TPC-20">09</option>
  <option value="10" data-sams="K-6ALN-22,K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6HOP-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6NWM-01,L-6ALN-20">10</option>
  <option value="11" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6KAM-20,K-6KAT-20,K-6KLB-01,K-6MJM-01,K-6NRG-20,K-6NWM-01,L-6ALN-21">11</option>
  <option value="12" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-20">12</option>
  <option value="13" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NRG-20,K-6NWM-01,L-6ALN-05">13</option>
  <option value="14" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6EXM-01,K-6NWM-01,L-6ALN-20,L-6ALN-21,X-6ALN-05">14</option>
  <option value="15" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,L-6ALN-23">15</option>
  <option value="16" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-21,X-6COI-01">16</option>
  <option value="17" data-sams="K-6ALN-22,K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01,L-6ALN-23,X-6COI-01">17</option>
  <option value="18" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6HOP-01,K-6MJM-01,K-6NWM-01">18</option>
  <option value="19" data-sams="K-6CVN-20,K-6ESP-20,K-6ESP-21,K-6NWM-01,X-6COI-01">19</option>
  <option value="20" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-20,K-6ESP-21,K-6NWM-01">20</option>
  <option value="21" data-sams="K-6CVN-20,K-6DNK-20,K-6ESP-21,K-6NWM-01">21</option>
  <option value="22" data-sams="K-6CVN-20,K-6DNK-20,K-6MJM-01,K-6NWM-01">22</option>
  <option value="23" data-sams="K-6DNK-20,X-6COI-01">23</option>
  <option value="24" data-sams="K-6CVN-20,K-6DNK-20">24</option>
  <option value="25" data-sams="L-6ALN-20,L-6ALN-23">25</option>
  <option value="27" data-sams="L-6ALN-20">27</option>
  <option value="28" data-sams="L-6ALN-20">28</option>
  <option value="30" data-sams="L-6ALN-20">30</option>
  <option value="31" data-sams="L-6ALN-20">31</option>
        </select>

        <label for="vactruck-Pit-Note-ID">Pit Note ID:</label>
        <input type="text" id="vactruck-Pit-Note-ID" name="vactruck-Pit-Note-ID" required />

        <label for="vactruck-comments">Any additional comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
        <textarea id="vactruck-comments" name="vactruck-comments" placeholder="If there are no additional comments, there is no need to enter anything here"></textarea>
                
	<label>
	<input type="checkbox" id="vactruck-completed" name="vactruck-completed" />
	Pit Cleanout Completed
	</label>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('vactruck')">Back</button>
          <button type="submit" id="vactruck-submit-btn">Submit Vac Truck</button>
        </div>
      </form>
    </div>

    <div id="form-gearbox" class="form-section hidden">
      <h3>Fleet Maintenance Register</h3>
      <p>Please complete for Genus Services fleet maintenance activities.</p>
      <form id="gearbox-form" onsubmit="return validateGenericForm('gearbox-form')">

        <!-- Hardcoded company -->
        <input type="hidden" name="company-name" value="Genus Services">

        <label for="gearbox-entry-person">Entry Person Name</label>
        <div id="gearbox-entry-person" class="crew-checkbox"></div>
        <input type="hidden" id="gearbox-entry-person-hidden" name="entry-person" required />

        <label for="gearbox-entry-date">Entry Date</label>
        <input type="date" id="gearbox-entry-date" name="entry-date" required />

        <label for="gearbox-vehicle-type">Vehicle type</label>
        <select id="gearbox-vehicle-type" name="vehicle-type" required>
          <option value="">Select one</option>
          <option value="Directional Drill">Directional Drill</option>
          <option value="Excavator">Excavator</option>
          <option value="Flatbed Truck">Flatbed Truck</option>
          <option value="Light Vehicle">Light Vehicle</option>
          <option value="Mud Mixing Tanks">Mud Mixing Tank</option>
          <option value="Rockbreaker">Rockbreaker</option>
          <option value="Trailer">Trailer</option>
          <option value="Vacuum Excavator">Vacuum Excavator</option>
          <option value="Vacuum Truck">Vacuum Truck</option>
        </select>

        <label for="gearbox-fleet-number">Fleet number</label>
        <select id="gearbox-fleet-number" required>
          <option value="">-- Select vehicle type first --</option>
        </select>

        <!-- Loading indicator -->
        <p id="fleet-loading" style="color:#666;font-size:0.8em;margin:4px 0 0;">
          Loading fleet numbers...
        </p>

        <label for="gearbox-gearbox-f-number">Gear box F-number (include all associated pre-start F numbers) - <em>Enter "N/A" if not relevant</em></label>
        <input type="text" id="gearbox-gearbox-f-number" placeholder="e.g. F-123456, F-789012" autocomplete="off" required/>
        <p id="validation-message" style="color: #d32f2f; font-size: 0.9em; min-height: 1.2em; margin-top: 4px;"></p>
        <p>
          Enter one or more F-numbers in format <strong>F-######</strong> or <strong>F-#######, F-#####</strong>.<br>
          Separate multiple values with <strong>, </strong> (comma + space).
        </p>

        <label for="gearbox-Maintenance-Required">Maintenance Required</label>
        <textarea id="gearbox-Maintenance-Required" name="gearbox-Maintenance-Required" placeholder="Enter as per pre-start / Gearbox Fault description(s)"></textarea>

        <label for="gearbox-maintenance-completed-by">Maintenance Completed By</label>
        <select id="gearbox-maintenance-completed-by" name="maintenance-completed-by" required onchange="toggleOther(this, 'gearbox-maintenance-other')">
          <option value="">Select one</option>
          <option value="Onsite / N2P Work Location">Onsite / N2P Work Location</option>
          <option value="Genus Workshop">Genus Workshop</option>
          <option value="Third Party Supplier Workshop">Third Party Supplier Workshop</option>
          <option value="Other">Other</option>
        </select>

        <div id="gearbox-maintenance-other" class="discipline-conditional-fields" style="display: none;">
          <label for="gearbox-maintenance-other-text">If Other, please specify</label>
          <input type="text" id="gearbox-maintenance-other-text" name="maintenance-completed-by-other" />
        </div>

        <label for="gearbox-repair-location">Repair Location</label>
        <select id="gearbox-repair-location" name="repair-location" required onchange="toggleOther(this, 'gearbox-repair-other')">
          <option value="">Select one</option>
          <option value="Genus Fleet / Workshop">Genus Fleet / Workshop</option>
          <option value="Genus Fleet / Outsourced">Genus Fleet / Outsourced</option>
          <option value="N2P Engaged Repairer">N2P Engaged Repairer</option>
          <option value="Other">Other</option>
        </select>

        <div id="gearbox-repair-other" class="discipline-conditional-fields" style="display: none;">
          <label for="gearbox-repair-other-text">If Other, please specify</label>
          <input type="text" id="gearbox-repair-other-text" name="repair-location-other" />
        </div>

        <label for="gearbox-estimated-cost">Estimated Repairs Cost</label>
        <select id="gearbox-estimated-cost" name="estimated-cost" required onchange="toggleOther(this, 'gearbox-estimated-cost-other')">
          <option value="">Select one</option>
          <option value="$0-$1000">$0-$1000</option>
          <option value="$1000-$2000">$1000-$2000</option>
          <option value="$2000-$5000">$2000-$5000</option>
          <option value="$5000 +">$5000 +</option>
          <option value="Unknown">Unknown</option>
          <option value="Quoted Cost">Quoted Cost</option>
        </select>

        <!-- This div will now show/hide correctly -->
        <div id="gearbox-estimated-cost-other" class="discipline-conditional-fields" style="display: none;">
          <label for="gearbox-estimated-cost-other-text">If you have an actual quote cost, please specify ($)</label>
          <input type="text" id="gearbox-estimated-cost-other-text" name="estimated-cost-other" placeholder="e.g. 2850" />
        </div>

        <label for="gearbox-estimated-duration">Est. Repair Duration</label>
        <select id="gearbox-estimated-duration" name="estimated-duration" required>
          <option value="">Select one</option>
          <option value="1-3 days">1-3 days</option>
          <option value="7 days">7 days</option>
          <option value="7 days (swing break)">7 days (swing break)</option>
          <option value="Between 1 & 2 weeks">Between 1 & 2 weeks</option>
          <option value="2 weeks plus">2 weeks plus</option>
        </select>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('gearbox')">Back</button>
          <button type="submit">Submit Fleet Maintenance</button>
        </div>
      </form>
    </div>
  </div>
  </main>

  <script>

    /* ============================================================
       1. GLOBAL VARIABLES
       ============================================================ */

    // Google Maps Places  tracks the last validated place for BOG site location
    let bogLocationSelectedPlace = null;
    let reinstatementLocationSelectedPlace = null;

    // Gearbox Fleet API
    const FLEET_API_URL = 'https://script.google.com/macros/s/AKfycbxl2p6cubjeeKQqL1L889Kr8s1vl2-rQhsdOqXA8hMtAzM-uMlB7tSnQnNNp66zc1FP/exec';
    let vehicleSel, fleetSel, loadingMsg, fleetCache = {};

    // Crew Names Google Apps Script endpoint
    const CREW_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyvuqOaLGTX27mWvzzDEhYLR1yXHpfP9Md3sT-aRnv_-_2pGpkZtANHjF67V-j5x8vf/exec';

    // Airtable REST API base (used by Reinstatement, Pit Link-in, Vac Truck lookup/update workers)
    const AIRTABLE_API_BASE = 'https://airtable-api.richard-ociepa.workers.dev';


    /* ============================================================
       2. AIRTABLE CONFIGURATION & SUBMIT FUNCTION
       ============================================================ */

    const AIRTABLE_CONFIG = {
      forecast: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'Forecast',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      },
      bog: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'BOG',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      },
      reinstatement: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'Reinstatement',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      },
      pitlinkin: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'Pit Link-in',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      },
      vactruck: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'Vac Truck',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      },
      gearbox: {
        baseId: 'appegmSLEvbJSkRvd',
        tableId: 'Gearbox',
        apiKey: 'patHwUeS1KtSAEshe.fbfaf206fded22941c87960a4a9b5c2992b69a3a86c8e23592d550905a42d936'
      }
    };

    function submitToAirtable(formType, formData) {
      const config = AIRTABLE_CONFIG[formType];
      const url = `https://api.airtable.com/v0/${config.baseId}/${config.tableId}`;
      return fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${config.apiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          records: [{ fields: formData }],
          typecast: true
        })
      });
    }


    /* ============================================================
       3. UTILITY FUNCTIONS
       ============================================================ */

    // Reload the page and return to the form selection screen
    function confirmReset(formType) {
      const isConfirmed = confirm("Are you sure you want to reset this form and return to the form selection screen?");
      if (isConfirmed) {
        location.reload();
      }
    }

    function returnToFormSwitcher() {
      location.reload();
    }

    // Insert a DOM node immediately after a reference node
    function insertAfter(newNode, referenceNode) {
      if (referenceNode && referenceNode.parentNode) {
        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
      }
    }

    // Show or hide a form field (and its label) by ID, managing the required attribute
    function hideById(id, hide) {
      const el = document.getElementById(id);
      const label = document.querySelector(`label[for="${id}"]`);
      if (el) {
        el.style.display = hide ? "none" : "";
        if (hide) {
          el.removeAttribute("required");
        } else if (
          ["INPUT", "SELECT", "TEXTAREA"].includes(el.tagName) &&
          id !== "bog-comments" &&
          id !== "bog-onsite-crew-lead-EnableID"
        ) {
          el.setAttribute("required", "required");
        }
      }
      if (label) label.style.display = hide ? "none" : "";
    }

    // Show the form for the selected form type; hide all others and update nav button states
    function showForm(formType) {
      console.log('showForm called with:', formType);

      document.getElementById('thank-you-message').style.display = 'none';

      const forms = ['form-forecast', 'form-bog', 'form-reinstatement', 'form-pitlinkin', 'form-vactruck', 'form-gearbox'];
      forms.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.classList.add('hidden');
          element.style.display = 'none';
        }
      });

      const targetForm = document.getElementById(`form-${formType}`);
      if (targetForm) {
        targetForm.classList.remove('hidden');
        targetForm.style.display = 'block';
        console.log(`Showing form: form-${formType}`);
      } else {
        console.error(`Form not found: form-${formType}`);
      }

      setDefaultDate();

      const buttons = ['btn-forecast', 'btn-bog', 'btn-reinstatement', 'btn-pitlinkin', 'btn-vactruck', 'btn-gearbox'];
      buttons.forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
          if (btnId === `btn-${formType}`) {
            btn.classList.add('active');
            btn.style.display = 'inline-block';
          } else {
            btn.classList.remove('active');
            btn.style.display = 'none';
          }
        }
      });
    }


    /* ============================================================
       4. DATE & TIME FUNCTIONS
       ============================================================ */

    // Set today's date (Perth/AWST) as the default value across all date fields
    function setDefaultDate() {
      const now = new Date();
      const perthTime = new Date(now.toLocaleString("en-US", { timeZone: "Australia/Perth" }));
      const year = perthTime.getFullYear();
      const month = String(perthTime.getMonth() + 1).padStart(2, '0');
      const day = String(perthTime.getDate()).padStart(2, '0');
      const todayString = `${year}-${month}-${day}`;

      const dateFields = [
        'bog-date',
        'pitlinkin-date',
        'reinstatement-date',
        'vactruck-date',
        'gearbox-entry-date'
      ];
      dateFields.forEach(id => {
        const field = document.getElementById(id);
        if (field) field.value = todayString;
      });
    }

    // Calculate and display the correct Forecast week commencing / week ending dates
    function updateForecastWeekDates() {
      const today = new Date();
      const cutoffDate = new Date('2025-12-25T23:59:59');

      let weekCommencing, weekEnding;

      if (today <= cutoffDate) {
        // Temporary override for Christmas/New Year shutdown period
        weekCommencing = new Date('2026-01-05T00:00:00'); // Monday 5 January 2026
        weekEnding     = new Date('2026-01-11T23:59:59'); // Sunday 11 January 2026
      } else {
        // Dynamic calculation (active from 26 Dec 2025 onwards)
        const dayOfWeek  = today.getDay();   // 0 = Sunday  6 = Saturday
        const currentHour = today.getHours();

        let daysToAdd = 0;
        switch (dayOfWeek) {
          case 1: daysToAdd = 7;  break; // Monday
          case 2: daysToAdd = 6;  break; // Tuesday
          case 3: daysToAdd = 5;  break; // Wednesday
          case 4: daysToAdd = currentHour < 17 ? 4 : 11; break; // Thursday  before/after 5 PM
          case 5: daysToAdd = 10; break; // Friday
          case 6: daysToAdd = 9;  break; // Saturday
          case 0: daysToAdd = 8;  break; // Sunday
        }

        weekCommencing = new Date(today);
        weekCommencing.setDate(today.getDate() + daysToAdd);
        weekCommencing.setHours(0, 0, 0, 0);

        weekEnding = new Date(weekCommencing);
        weekEnding.setDate(weekCommencing.getDate() + 6);
      }

      const formatter = new Intl.DateTimeFormat('en-AU', { day: '2-digit', month: '2-digit', year: 'numeric' });
      document.getElementById('weekCommencingDate').innerText = formatter.format(weekCommencing);
      document.getElementById('weekEndingDate').innerText     = formatter.format(weekEnding);
    }


    // Populate a <select> with 30-minute interval options in 12-hour display format
    function generateTimeOptions(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      for (let hour = 0; hour < 24; hour++) {
        for (let min = 0; min < 60; min += 30) {
          const hourStr    = hour.toString().padStart(2, '0');
          const minStr     = min.toString().padStart(2, '0');
          const time24     = `${hourStr}:${minStr}`;
          let displayHour  = hour % 12;
          displayHour      = displayHour === 0 ? 12 : displayHour;
          const ampm       = hour < 12 ? 'AM' : 'PM';
          const displayStr = `${displayHour}:${minStr} ${ampm}`;
          const option     = document.createElement('option');
          option.value       = time24;
          option.textContent = displayStr;
          select.appendChild(option);
        }
      }
    }

    // Combine the BOG date + start/finish time selects into ISO timestamp hidden fields
    function updateBogTimestamps() {
      const dateEl   = document.getElementById('bog-date');
      const startEl  = document.getElementById('bog-estimated-start-time');
      const finishEl = document.getElementById('bog-estimated-finish-time');
      const outStart  = document.getElementById('bog-estimated-start-timestamp');
      const outFinish = document.getElementById('bog-estimated-finish-timestamp');
      if (dateEl && startEl && finishEl && outStart && outFinish) {
        const date   = dateEl.value;
        const start  = startEl.value;
        const finish = finishEl.value;
        if (date && start && finish) {
          outStart.value  = date + 'T' + start  + ':00';
          outFinish.value = date + 'T' + finish + ':00';
        }
      }
    }


    /* ============================================================
       5. UI MESSAGE FUNCTIONS
       ============================================================ */

    function showErrorMessage() {
      const messageBox   = document.getElementById('thank-you-message');
      const messageTitle = document.getElementById('message-title');
      const messageBody  = document.getElementById('message-body');
      messageTitle.textContent = '';
      messageBody.textContent  = 'Please review your submission and ensure all fields are completed.';
      messageBody.style.color  = 'red';
      messageBox.style.display = 'block';
    }

    function showSuccessMessage() {
      const messageBox   = document.getElementById('thank-you-message');
      const messageTitle = document.getElementById('message-title');
      const messageBody  = document.getElementById('message-body');
      messageTitle.textContent = 'Thank you!';
      messageBody.innerHTML    = 'Your form has been submitted successfully.<br><br><button type="button" class="btn-back" onclick="returnToFormSwitcher()">Submit Another Form</button><br><small>You will be redirected to form selection in 5 seconds...</small>';
      messageBody.style.color  = '';
      messageBox.style.display = 'block';
      setTimeout(() => {
        returnToFormSwitcher();
        document.getElementById('thank-you-message').style.display = 'none';
      }, 5000);
    }

    function hideMessage() {
      document.getElementById('thank-you-message').style.display = 'none';
      return true;
    }


    /* ============================================================
       6. VALIDATION FUNCTIONS
       ============================================================ */

    // Apply red border styling to all :invalid fields within a form
    function addFieldErrorStyling(form) {
      form.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
      form.querySelectorAll(':invalid').forEach(field => {
        field.classList.add('field-error');
        if (field.parentElement) {
          field.parentElement.classList.add('field-error');
        }
      });
    }

    // Remove all error styling and hide discipline day error messages within a form
    function clearFieldErrors(form) {
      form.querySelectorAll('.field-error, .error-field').forEach(field => {
        field.classList.remove('field-error', 'error-field');
      });
      form.querySelectorAll('.discipline-days-error').forEach(msg => {
        msg.style.display = 'none';
      });
    }

    // Generic form validity check  used by Reinstatement, Pit Link-in, Vac Truck, Gearbox
    function validateGenericForm(formId) {
      const form = document.getElementById(formId);
      if (!form.checkValidity()) {
        showErrorMessage();
        addFieldErrorStyling(form);
        form.reportValidity();
        return false;
      }
      return true;
    }

    // Validate that at least one SWMS discipline has been selected (BOG form)
    function validateSWMS() {
      const checkedSWMS  = document.querySelectorAll('input[name="bog-SWMS[]"]:checked');
      const errorElement = document.getElementById('swms-error');
      const isValid      = checkedSWMS.length > 0;
      if (errorElement) {
        errorElement.style.display = isValid ? 'none' : 'block';
        if (!isValid) {
          errorElement.textContent = 'Please select your required site specific SWMS';
        }
      }
      return isValid;
    }

    // Full BOG form validation  checks native validity plus SWMS selection
    function validateBogForm() {
      const form    = document.querySelector('#bog-form');
      const isValid = form.checkValidity();
      const swmsValid = validateSWMS();
      if (!isValid || !swmsValid) {
        showErrorMessage();
        addFieldErrorStyling(form);
        form.reportValidity();
        return false;
      }
      return true;
    }

    // Forecast form validation  checks base fields plus discipline / crew / days selection
    function validateForecastForm() {
      const form = document.getElementById('forecast-form');
      let isValid = true;

      clearFieldErrors(form);

      if (!form.checkValidity()) isValid = false;

      const disciplineCheckboxes = form.querySelectorAll('input[name="discipline[]"]:checked');
      const disciplineError      = document.getElementById('discipline-error');

      if (disciplineCheckboxes.length === 0) {
        disciplineError.style.display = 'block';
        document.querySelector('.discipline-checkbox-group').classList.add('field-error');
        isValid = false;
      } else {
        disciplineError.style.display = 'none';
        document.querySelector('.discipline-checkbox-group').classList.remove('field-error');
      }

      disciplineCheckboxes.forEach(checkbox => {
        const discipline  = checkbox.value.toLowerCase().replace(/[^a-z]/g, '-');
        const crewsInput  = document.getElementById(`${discipline}-crews`);
        const daysError   = document.getElementById(`${discipline}-days-error`);

        if (crewsInput && (!crewsInput.value || crewsInput.value < 1)) {
          crewsInput.classList.add('error-field');
          isValid = false;
        }

        const daysChecked = form.querySelectorAll(`input[name="${discipline}-days[]"]:checked`);
        if (daysChecked.length === 0) {
          daysError.style.display = 'block';
          isValid = false;
        } else {
          daysError.style.display = 'none';
        }
      });

      if (!isValid) {
        showErrorMessage();
        addFieldErrorStyling(form);
        form.reportValidity();
        return false;
      }
      return true;
    }

    // Validate a list of Note ID fields  each must be 57 digits (unless disabled)
    function validateNoteIdFields(fieldList) {
      let isValid = true;
      let errorMessage = '';
      fieldList.forEach(({ id, name }) => {
        const el    = document.getElementById(id);
        const value = el ? el.value.trim() : '';
        if (el && !el.disabled) {
          if (!/^\d{5,7}$/.test(value)) {
            errorMessage += `- '${name}' must contain between 5-7 digits.\n`;
            el.classList.add('field-error');
            isValid = false;
          } else {
            el.classList.remove('field-error');
          }
        } else if (el) {
          el.classList.remove('field-error');
        }
      });
      if (!isValid) alert('Please correct the following errors before submitting:\n' + errorMessage);
      return isValid;
    }


    /* ============================================================
       7. CONDITIONAL FIELD TOGGLE FUNCTIONS
       ============================================================ */

    // Forecast: toggle a discipline's sub-fields when its checkbox is checked/unchecked
    function toggleDisciplineFields(checkbox) {
      const discipline = checkbox.value.toLowerCase().replace(/\s/g, '-').replace(/--+/g, '-');
      const fieldsDiv  = document.getElementById(`discipline-${discipline}-fields`);
      if (!fieldsDiv) return;

      if (checkbox.checked) {
        fieldsDiv.style.display = 'block';
        const crewsInput = document.getElementById(`${discipline}-crews`);
        if (crewsInput && crewsInput.value === '') crewsInput.value = '1';
      } else {
        fieldsDiv.style.display = 'none';
        const crewsInput = document.getElementById(`${discipline}-crews`);
        if (crewsInput) crewsInput.value = '';
        fieldsDiv.querySelectorAll(`input[name="${discipline}-days[]"]`).forEach(cb => cb.checked = false);
        const daysError = document.getElementById(`${discipline}-days-error`);
        if (daysError) daysError.style.display = 'none';
      }
    }

    // Forecast: show/hide phase-specific discipline groups when build phase changes
    function showBuildPhaseContent() {
      const buildPhase          = document.getElementById('forecast-build-phase').value;
      const designContent       = document.getElementById('design-content');
      const constructionContent = document.getElementById('construction-content');

      if (designContent)       designContent.style.display = 'none';
      if (constructionContent) constructionContent.style.display = 'none';

      if (buildPhase === 'Design'       && designContent)       designContent.style.display = 'block';
      if (buildPhase === 'Construction' && constructionContent) constructionContent.style.display = 'block';

      resetAllDisciplineFields();
    }

    // Forecast: clear all discipline checkboxes and their conditional fields
    function clearDisciplineFields(fieldsId) {
      const fields = document.getElementById(fieldsId);
      if (!fields) return;
      fields.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
      fields.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
      fields.querySelectorAll('.discipline-days-error').forEach(err => err.style.display = 'none');
    }

    function resetAllDisciplineFields() {
      document.querySelectorAll('input[name="discipline[]"]').forEach(checkbox => {
        checkbox.checked = false;
        const disciplineValue = checkbox.value.toLowerCase().replace(/[^a-z]/g, '-');
        const fieldsId        = 'discipline-' + disciplineValue + '-fields';
        const fields          = document.getElementById(fieldsId);
        if (fields) {
          fields.style.display = 'none';
          clearDisciplineFields(fieldsId);
        }
      });
    }

    // BOG: show/hide the ACM notification field based on the ACM select value
    function toggleACMField() {
      const select   = document.getElementById("bog-ACM");
      const acmField = document.getElementById("bog-acm-notification-field");
      const acmYes   = document.getElementById("bog-acm-yes");
      const show = select.value === "Yes";
      acmField.style.display = show ? "block" : "none";
      show ? acmYes.setAttribute("required", "required") : acmYes.removeAttribute("required");
    }

    // Reinstatement: show/hide "Other" text inputs for surface type, location type, and materials
    function toggleSurfaceTypeField() {
      const sel   = document.getElementById("reinstatement-surface-type");
      const field = document.getElementById("reinstatement-surface-type-notification-field");
      const input = document.getElementById("reinstatement-surface-type-other");
      const show  = sel.value === "Other";
      field.style.display = show ? "block" : "none";
      input.required = show;
      if (!show) input.value = "";
    }

    function toggleLocationTypeField() {
      const sel   = document.getElementById("reinstatement-location-type");
      const field = document.getElementById("reinstatement-location-type-notification-field");
      const input = document.getElementById("reinstatement-location-type-other");
      const show  = sel.value === "Other";
      field.style.display = show ? "block" : "none";
      input.required = show;
      if (!show) input.value = "";
    }

    function toggleMaterialTypeField() {
      const sel   = document.getElementById("reinstatement-material-type");
      const field = document.getElementById("reinstatement-material-type-notification-field");
      const input = document.getElementById("reinstatement-material-type-other");
      const show  = sel.value === "Other";
      field.style.display = show ? "block" : "none";
      input.required = show;
      if (!show) input.value = "";
    }

    function togglePermMaterialTypeField() {
      const sel   = document.getElementById("reinstatement-perm-material");
      const field = document.getElementById("reinstatement-perm-material-notification-field");
      const input = document.getElementById("reinstatement-perm-material-other");
      const show  = sel.value === "Other";
      field.style.display = show ? "block" : "none";
      input.required = show;
      if (!show) input.value = "";
    }

    // Pit Link-in: show/hide the RRP reason field when RRP is "No"
    function toggleRRPCompleteField() {
      const sel   = document.getElementById("pitlinkin-rrp");
      const field = document.getElementById("pitlinkin-rrp-notification-field");
      const input = document.getElementById("pitlinkin-rrp-no");
      const show  = sel.value === "No";
      field.style.display = show ? "block" : "none";
      show ? input.setAttribute("required", "required") : input.removeAttribute("required");
    }

    // Gearbox: show/hide an "Other/Quoted Cost" free-text field based on a select value
    function toggleOther(select, divId) {
      const div       = document.getElementById(divId);
      const textInput = div.querySelector('input[type="text"]');
      const show      = select.value === 'Other' || select.value === 'Quoted Cost';
      div.style.display = show ? 'block' : 'none';
      if (textInput) {
        textInput.required = show;
        if (!show) textInput.value = '';
      }
    }


    /* ============================================================
       8. GEARBOX  F-NUMBER VALIDATION
       ============================================================ */

    (function initGearboxFNumberValidation() {
      // Elements may not exist if the DOM is not yet ready; we use DOMContentLoaded
      document.addEventListener('DOMContentLoaded', function () {
        const input = document.getElementById('gearbox-gearbox-f-number');
        const msg   = document.getElementById('validation-message');
        if (!input || !msg) return;

        function setValid(text) {
          msg.style.color = '#2e7d32';
          msg.textContent = text;
          input.setCustomValidity('');
        }

        function setError(text) {
          msg.style.color = '#d32f2f';
          msg.textContent = text;
          input.setCustomValidity(text);
        }

        function validateAndShow(value) {
          const trimmed = value.trim();
          if (trimmed.toUpperCase() === 'N/A' || trimmed === '') { setValid('Valid'); return; }
          const pattern = /^(F-\d{5,8})(,\s*F-\d{6,8})*$/;
          pattern.test(trimmed) ? setValid('Valid') : setError('Invalid: Use F-123456 or F-123456, F-7890123 (N/A allowed)');
        }

        // Format and validate on blur
        input.addEventListener('focusout', function () {
          let value = input.value.trim();

          if (/^\s*n\s*\/\s*a\s*$/i.test(value)) { input.value = 'N/A'; setValid('Valid'); return; }
          if (value === '') { setError('This field is required.'); return; }

          let parts = value.split(/\s*,\s*/).filter(Boolean).map(part => {
            let cleaned = part;
            if (/^f-/i.test(cleaned)) cleaned = 'F-' + cleaned.slice(2);
            return cleaned.replace(/[^0-9F\-]/gi, '');
          });

          const formatted = parts.filter(Boolean).join(', ');
          input.value = formatted;
          validateAndShow(formatted);
        });

        // Clear message on focus
        input.addEventListener('focus', () => msg.textContent = '');

        // Trigger validation on form submit
        input.closest('form')?.addEventListener('submit', e => {
          input.dispatchEvent(new Event('focusout'));
          if (input.validationMessage) { e.preventDefault(); input.focus(); }
        });
      });
    })();


    /* ============================================================
       9. GEARBOX  FLEET NUMBER DROPDOWN
       ============================================================ */

    function updateFleetDropdown() {
      const type = vehicleSel.value.trim();
      fleetSel.innerHTML = '<option value="">-- Loading... --</option>';
      loadingMsg.textContent = 'Loading...';
      loadingMsg.style.color = '#666';

      if (!type) {
        fleetSel.innerHTML = '<option value="">-- Select vehicle type first --</option>';
        loadingMsg.textContent = '';
        return;
      }

      if (fleetCache[type]) { populateFleetDropdown(fleetCache[type]); return; }

      const url = `${FLEET_API_URL}?fleet=${encodeURIComponent(type)}&t=${Date.now()}`;
      console.log('CALLING FLEETMAPPING ', url);

      fetch(url, { cache: 'no-store' })
        .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}: ${r.statusText}`); return r.json(); })
        .then(data => {
          console.log('FLEETMAPPING RESPONSE:', data);
          if (!Array.isArray(data)) throw new Error('Expected array, got: ' + typeof data);
          fleetCache[type] = data;
          populateFleetDropdown(data);
          loadingMsg.textContent = 'Loaded.';
          setTimeout(() => loadingMsg.textContent = '', 1500);
        })
        .catch(err => {
          console.error('FETCH FAILED:', err);
          fleetSel.innerHTML = '<option value="">Failed to load</option>';
          loadingMsg.style.color = '#d32f2f';
          loadingMsg.textContent = 'Error  check console (F12)';
        });
    }

    function populateFleetDropdown(numbers) {
      fleetSel.innerHTML = '<option value="">-- Select fleet number --</option>';
      if (!Array.isArray(numbers) || numbers.length === 0) {
        fleetSel.innerHTML = '<option value="">No fleet numbers found</option>';
        return;
      }
      numbers.sort().forEach(num => {
        const opt = document.createElement('option');
        opt.value = num;
        opt.textContent = num;
        fleetSel.appendChild(opt);
      });
      if (numbers.length === 1) fleetSel.value = numbers[0];
    }


    /* ============================================================
       10. CREW MANAGEMENT FUNCTIONS
       ============================================================ */

    async function fetchCrewNames(company) {
      if (!company) return [];
      try {
        const url = `${CREW_WEBAPP_URL}?company=${encodeURIComponent(company)}`;
        const res = await fetch(url);
        return await res.json();
      } catch (err) {
        console.error("Failed to fetch crew names:", err);
        return [];
      }
    }

    function createRadioList(containerEl, hiddenInput, crewList) {
      containerEl.innerHTML = "";
      crewList.forEach(name => {
        const label = document.createElement("label");
        label.style.display = "block";
        const radio = document.createElement("input");
        radio.type  = "radio";
        radio.name  = containerEl.id + "-radio";
        radio.value = name;
        radio.addEventListener("change", () => hiddenInput.value = name);
        label.appendChild(radio);
        label.appendChild(document.createTextNode(name));
        containerEl.appendChild(label);
      });
    }

    function createCheckboxList(containerEl, hiddenInput, crewList) {
      containerEl.innerHTML = "";
      crewList.forEach(name => {
        const label    = document.createElement("label");
        label.style.display = "block";
        const checkbox = document.createElement("input");
        checkbox.type  = "checkbox";
        checkbox.value = name;
        checkbox.addEventListener("change", () => {
          const selected = Array.from(containerEl.querySelectorAll("input[type=checkbox]:checked")).map(cb => cb.value);
          hiddenInput.value = selected.join(", ");
        });
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(name));
        containerEl.appendChild(label);
      });
    }


    /* ============================================================
       11. GOOGLE MAPS AUTOCOMPLETE
       ============================================================ */

    // Called by the Google Maps script tag via the callback parameter
    function initAutocomplete() {
      const inputs = document.querySelectorAll(".address-autocomplete");
      inputs.forEach(input => {
        const autocomplete = new google.maps.places.Autocomplete(input, {
          types: ['address'], // Only allow street addresses and establishments (airports, parks, etc)
          componentRestrictions: { country: 'au' }
        });

        // Helper function to format address with proper commas
        function formatAddress(place) {
          if (!place.address_components) return place.formatted_address;
          
          // Extract components
          let streetNumber = '';
          let route = '';
          let locality = '';
          let area2 = ''; // suburb
          let area1 = ''; // state
          let postalCode = '';
          
          place.address_components.forEach(component => {
            const types = component.types;
            if (types.includes('street_number')) streetNumber = component.long_name;
            if (types.includes('route')) route = component.long_name;
            if (types.includes('locality')) locality = component.long_name;
            if (types.includes('sublocality') || types.includes('sublocality_level_1')) area2 = component.long_name;
            if (types.includes('administrative_area_level_1')) area1 = component.short_name;
            if (types.includes('postal_code')) postalCode = component.long_name;
          });
          
          // Build formatted address with proper commas
          let parts = [];
          if (streetNumber && route) parts.push(`${streetNumber} ${route}`);
          else if (route) parts.push(route);
          else if (place.name && !locality) parts.push(place.name); // For establishments
          
          if (area2) parts.push(area2);
          if (locality && locality !== area2) parts.push(locality);
          if (area1) parts.push(area1);
          if (postalCode) parts.push(postalCode);
          
          return parts.join(', ') || place.formatted_address;
        }

        // Helper function to validate address has required specificity
        function isSpecificEnough(place) {
          if (!place.address_components) return false;
          
          // Must have either:
          // 1. A route (street name), OR
          // 2. An establishment type (airport, park, etc)
          const hasRoute = place.address_components.some(c => c.types.includes('route'));
          const hasEstablishment = place.types && (
            place.types.includes('airport') ||
            place.types.includes('park') ||
            place.types.includes('point_of_interest') ||
            place.types.includes('establishment')
          );
          
          // Reject if it's ONLY a locality (city/town) or administrative area
          const isOnlyLocality = place.types && (
            place.types.includes('locality') ||
            place.types.includes('administrative_area_level_1') ||
            place.types.includes('administrative_area_level_2')
          ) && !hasRoute && !hasEstablishment;
          
          return !isOnlyLocality && (hasRoute || hasEstablishment);
        }

        // Special validation tracking for the BOG site location field
        if (input.id === 'bog-site-location') {
          autocomplete.addListener('place_changed', function () {
            const place = autocomplete.getPlace();
            console.log('BOG place_changed fired:', place);
            
            if (place && place.formatted_address) {
              if (isSpecificEnough(place)) {
                const formattedAddress = formatAddress(place);
                input.value = formattedAddress;
                bogLocationSelectedPlace    = place;
                input.dataset.valid         = "true";
                input.setCustomValidity("");
                console.log(' BOG location valid:', formattedAddress);
              } else {
                input.value = '';
                bogLocationSelectedPlace = null;
                input.dataset.valid = "false";
                alert('Please select a specific address (street name or location) rather than just a town or region.');
                console.log(' BOG location too generic');
              }
            }
          });

          input.addEventListener('input', function () {
            if (bogLocationSelectedPlace && input.value !== formatAddress(bogLocationSelectedPlace)) {
              console.log('User typing - clearing BOG location');
              bogLocationSelectedPlace = null;
              input.dataset.valid      = "false";
            }
            input.setCustomValidity("");
          });

          console.log('BOG autocomplete initialized');
        }

        // Special validation tracking for the Reinstatement address field
        if (input.id === 'reinstatement-address') {
          autocomplete.addListener('place_changed', function () {
            const place = autocomplete.getPlace();
            console.log('Reinstatement place_changed fired:', place);
            
            if (place && place.formatted_address) {
              if (isSpecificEnough(place)) {
                const formattedAddress = formatAddress(place);
                input.value = formattedAddress;
                reinstatementLocationSelectedPlace = place;
                input.dataset.valid                = "true";
                input.setCustomValidity("");
                console.log(' Reinstatement location valid:', formattedAddress);
              } else {
                input.value = '';
                reinstatementLocationSelectedPlace = null;
                input.dataset.valid = "false";
                alert('Please select a specific address (street name or location) rather than just a town or region.');
                console.log(' Reinstatement location too generic');
              }
            }
          });

          input.addEventListener('input', function () {
            if (reinstatementLocationSelectedPlace && input.value !== formatAddress(reinstatementLocationSelectedPlace)) {
              console.log('User typing - clearing Reinstatement location');
              reinstatementLocationSelectedPlace = null;
              input.dataset.valid                = "false";
            }
            input.setCustomValidity("");
          });

          console.log('Reinstatement autocomplete initialized');
        }
      });
    }


    /* ============================================================
       12. SAM  ADA FILTER
       ============================================================ */

    // Filters the ADA dropdown to show only options valid for the selected SAM
    // Applies across: pitlinkin, bog, reinstatement, vactruck
    document.addEventListener("DOMContentLoaded", function () {
      const formTypes = ["pitlinkin", "bog", "reinstatement", "vactruck"];

      formTypes.forEach(formType => {
        const samSelect = document.getElementById(`${formType}-SAM`);
        const adaSelect = document.getElementById(`${formType}-ADA`);
        if (!samSelect || !adaSelect) return;

        const originalADAOptions = Array.from(adaSelect.options).map(opt => ({
          value: opt.value,
          text:  opt.textContent,
          sams:  opt.getAttribute("data-sams")?.split(",") || []
        }));

        samSelect.addEventListener("change", function () {
          const selectedSAM = samSelect.value;
          adaSelect.innerHTML = "";
          const defaultOption = document.createElement("option");
          defaultOption.value       = "";
          defaultOption.textContent = "Select one";
          adaSelect.appendChild(defaultOption);

          originalADAOptions.forEach(opt => {
            if (opt.sams.includes(selectedSAM)) {
              const option = document.createElement("option");
              option.value = opt.value;
              option.textContent = opt.text;
              option.setAttribute("data-sams", opt.sams.join(","));
              adaSelect.appendChild(option);
            }
          });
        });
      });
    });


    /* ============================================================
       13. BOG  MOB / DEMOB CONDITIONAL FIELDS
       ============================================================ */

    document.addEventListener("DOMContentLoaded", function () {
      const mobCheckbox  = document.getElementById("bog-mob");
      const demobCheckbox = document.getElementById("bog-demob");
      if (!mobCheckbox || !demobCheckbox) { console.warn("Mob/Demob checkboxes not found in the DOM."); return; }

      const conditionalIds = [
        "bog-estimated-start-time",
        "bog-estimated-finish-time",
        "bog-site-contact",
        "bog-onsite-crew-lead-mobile",
        "bog-onsite-crew-lead-email",
        "bog-onsite-crew-lead-EnableID",
        "bog-Genus-FCM",
        "bog-ACM",
        "bog-acm-yes",
        "bog-guards",
        "bog-excavation",
        "bog-jha-uploaded",
        "bog-comments"
      ];

      const additionalMobOnlyBlocks = ["bog-ACM", "bog-comments"];

      const crewNumberLabel   = document.querySelector('label[for="bog-Number-of-People-at-Location"]');
      const crewNamesLabel    = document.querySelector('label[for="bog-crews-names"]');
      const enableIDField     = document.getElementById("bog-onsite-crew-lead-EnableID");
      const siteLocationLabel = document.querySelector('label[for="bog-site-location"]');

      const crewVehiclesFieldId  = "bog-crew-vehicles";
      const crewVehiclesLabelId  = "label-bog-crew-vehicles";
      const heavyVehiclesFieldId = "bog-heavy-vehicles";
      const heavyVehiclesLabelId = "label-bog-heavy-vehicles";

      function updateMobDemobState() {
        const isMob   = mobCheckbox.checked;
        const isDemob = demobCheckbox.checked;

        // Mutually exclusive
        if (isMob && isDemob) { mobCheckbox.checked = false; demobCheckbox.checked = false; return updateMobDemobState(); }

        conditionalIds.forEach(id => hideById(id, isMob));
        additionalMobOnlyBlocks.forEach(id => hideById(id, isMob));

        // Site location is always visible; only its label changes
        const siteLocationField = document.getElementById("bog-site-location");
        if (siteLocationField) { siteLocationField.style.display = ""; siteLocationField.setAttribute("required", "required"); }
        if (siteLocationLabel) siteLocationLabel.textContent = isMob ? "Departure Address" : "First Site Address";

        // SWMS section
        const swmsSection  = document.getElementById("bog-swms-section");
        const swmsFieldset = document.getElementById("bog-swms-fieldset");
        if (swmsSection)  swmsSection.style.display  = isMob ? "none" : "";
        if (swmsFieldset) swmsFieldset.style.display = isMob ? "none" : "";

        // HSE reminder paragraph
        const hseReminder = Array.from(document.querySelectorAll("p")).find(p =>
          p.textContent.includes("Construction JHA and Excavation permit process")
        );
        if (hseReminder) hseReminder.style.display = isMob ? "none" : "";

        // Dynamic crew / people labels
        if (crewNumberLabel) {
          crewNumberLabel.textContent = isMob
            ? "Number of people mobilising today for this discipline in this SAM"
            : isDemob
              ? "Number of people de-mobilising today for this discipline in this SAM"
              : "Number of People in Crew at Location";
        }

        if (crewNamesLabel) {
          crewNamesLabel.textContent = isMob
            ? "List Names of Workers Mobilising"
            : isDemob
              ? "List Names of Workers Demobilising"
              : "List Names of Workers in Crew";
        }

        // Remove existing dynamically-injected vehicle fields
        [crewVehiclesLabelId, crewVehiclesFieldId, heavyVehiclesLabelId, heavyVehiclesFieldId].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.remove();
        });

        if (isMob || isDemob) {
          const vehicleLabelText      = isMob ? "Number of crew vehicles being mobilised" : "Number of crew vehicles being de-mobilised";
          const heavyVehicleLabelText = isMob
            ? "Number of heavy vehicles being mobilised (please note, this is claimable once per SAM or as agreed in writing with FCM)"
            : "Number of heavy vehicles being de-mobilised (please note, this is claimable once per SAM or as agreed in writing with FCM)";

          // Heavy Vehicles
          const heavyLabel = document.createElement("label");
          heavyLabel.id      = heavyVehiclesLabelId;
          heavyLabel.htmlFor = heavyVehiclesFieldId;
          heavyLabel.textContent = heavyVehicleLabelText;
          const heavyInput = document.createElement("input");
          heavyInput.type     = "number";
          heavyInput.id       = heavyVehiclesFieldId;
          heavyInput.name     = "Number of heavy vehicles";
          heavyInput.step     = "1";
          heavyInput.required = true;
          insertAfter(heavyLabel, enableIDField);
          insertAfter(heavyInput, heavyLabel);

          // Crew Vehicles
          const crewLabel = document.createElement("label");
          crewLabel.id      = crewVehiclesLabelId;
          crewLabel.htmlFor = crewVehiclesFieldId;
          crewLabel.textContent = vehicleLabelText;
          const crewInput = document.createElement("input");
          crewInput.type     = "number";
          crewInput.id       = crewVehiclesFieldId;
          crewInput.name     = "Number of Crew vehicles";
          crewInput.step     = "1";
          crewInput.required = true;
          insertAfter(crewLabel, heavyInput);
          insertAfter(crewInput, crewLabel);
        }
      }

      mobCheckbox.addEventListener("change",  () => { if (mobCheckbox.checked)   demobCheckbox.checked = false; updateMobDemobState(); });
      demobCheckbox.addEventListener("change", () => { if (demobCheckbox.checked) mobCheckbox.checked   = false; updateMobDemobState(); });
      updateMobDemobState(); // Run once on load
    });


    /* ============================================================
       14. MAIN DOMContentLoaded  INITIALISATION & FORM HANDLERS
       ============================================================ */

    document.addEventListener('DOMContentLoaded', function () {

      // --- Initial page setup ---
      setDefaultDate();
      updateForecastWeekDates();

      // --- BOG time dropdowns ---
      generateTimeOptions('bog-estimated-start-time');
      generateTimeOptions('bog-estimated-finish-time');
      document.getElementById('bog-estimated-start-time')?.addEventListener('change', updateBogTimestamps);
      document.getElementById('bog-estimated-finish-time')?.addEventListener('change', updateBogTimestamps);
      document.getElementById('bog-date')?.addEventListener('change', updateBogTimestamps);
      document.getElementById('bog-form')?.addEventListener('submit', updateBogTimestamps);

      // --- Gearbox fleet dropdown setup ---
      vehicleSel  = document.getElementById('gearbox-vehicle-type');
      fleetSel    = document.getElementById('gearbox-fleet-number');
      loadingMsg  = document.getElementById('fleet-loading') || { textContent: '', style: {} };
      if (vehicleSel && fleetSel) {
        vehicleSel.addEventListener('change', updateFleetDropdown);
        console.log('Fleet dropdown ready. Pick a vehicle type.');
      } else {
        console.error('ERROR: Missing gearbox-vehicle-type or gearbox-fleet-number element');
      }

      // --- Crew names initialisation ---
      const crewSections = [
        { crew: "bog-crews-names", lead: "bog-site-contact", multiCrew: true, companyField: "bog-company-name" },
        { lead: "forecast-site-contact",      companyField: "forecast-company-name"      },
        { lead: "reinstatement-site-contact", companyField: "reinstatement-company-name" },
        { lead: "vactruck-site-contact",      companyField: null                         },
        { lead: "pitlinkin-site-contact",     companyField: null                         },
        { lead: "gearbox-entry-person",       companyField: null                         }
      ];

      async function initCrewSections() {
        for (const section of crewSections) {
          const hiddenLead = section.lead ? document.getElementById(section.lead + "-hidden") : null;
          const leadEl     = section.lead ? document.getElementById(section.lead)             : null;
          const hiddenCrew = section.crew ? document.getElementById(section.crew + "-hidden") : null;
          const crewEl     = section.crew ? document.getElementById(section.crew)             : null;
          const companyName = section.companyField ? document.getElementById(section.companyField)?.value : "Genus Services";
          const crewList    = await fetchCrewNames(companyName);

          if (crewEl && hiddenCrew && section.multiCrew) createCheckboxList(crewEl, hiddenCrew, crewList);
          if (leadEl && hiddenLead) createRadioList(leadEl, hiddenLead, crewList);

          if (section.companyField) {
            const companyEl = document.getElementById(section.companyField);
            if (companyEl) {
              companyEl.addEventListener("change", async () => {
                const updatedList = await fetchCrewNames(companyEl.value);
                if (crewEl && hiddenCrew && section.multiCrew) createCheckboxList(crewEl, hiddenCrew, updatedList);
                if (leadEl && hiddenLead) createRadioList(leadEl, hiddenLead, updatedList);
              });
            }
          }
        }
      }
      initCrewSections();

      // --- Hide all forms on initial load, show all nav buttons ---
      const allForms = ['form-forecast', 'form-bog', 'form-reinstatement', 'form-pitlinkin', 'form-vactruck', 'form-gearbox'];
      allForms.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.classList.add('hidden');
          element.style.display = 'none';
          const errorFields = element.querySelectorAll('.field-error');
          errorFields.forEach(field => field.classList.remove('field-error'));
        }
      });

      const allButtons = ['btn-forecast', 'btn-bog', 'btn-reinstatement', 'btn-pitlinkin', 'btn-vactruck', 'btn-gearbox'];
      allButtons.forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) { btn.style.display = 'inline-block'; btn.classList.remove('active'); }
      });


      /*  FORECAST FORM SUBMIT  */
      document.getElementById('forecast-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit"; }, 7000);
        }
        if (!validateForecastForm()) return;

        const selectedDisciplines = Array.from(document.querySelectorAll('input[name="discipline[]"]:checked'))
          .map(cb => cb.value);

        const formData = {
          'Week Commencing': document.getElementById('weekCommencingDate').textContent,
          'Week Ending':     document.getElementById('weekEndingDate').textContent,
          'Construction Partner Company Name':         document.getElementById('forecast-company-name').value,
          'SAM':                                       document.getElementById('forecast-sam-id').value,
          'DP Field Supervisor':                       document.getElementById('forecast-Genus-FCM').value,
          'Construction Partner Technician Name':      document.getElementById('forecast-site-contact-hidden').value,
          'Construction Partner Technician Number missing 0': document.getElementById('forecast-onsite-crew-lead-mobile').value,
          'Construction Partner Technician Email':     document.getElementById('forecast-onsite-crew-lead-email').value,
          'Enable ID (if applicable)':                 document.getElementById('forecast-onsite-crew-lead-EnableID').value,
          'Build Phase':                               document.getElementById('forecast-build-phase').value,
          'Activity raw':                              selectedDisciplines
        };

        selectedDisciplines.forEach(discipline => {
          const key        = discipline.toLowerCase().replace(/\s/g, '-');
          const crewsInput = document.getElementById(`${key}-crews`);
          formData[`${discipline}-Crews`]    = crewsInput ? crewsInput.value : '';
          const daysChecked = document.querySelectorAll(`input[name="${key}-days[]"]:checked`);
          formData[`${discipline}-Workdays`] = Array.from(daysChecked).map(cb => cb.value).join(', ');
        });

        try {
          const response = await submitToAirtable('forecast', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting Forecast form:', error);
          alert('Error submitting form. Please try again.');
        }
      });


      /*  BOG FORM SUBMIT  */
      document.getElementById('bog-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit BOG"; }, 7000);
        }

        const isMobDay = document.getElementById('bog-mob').checked;

        // 1. Onsite Crew Lead is required when not a mobilisation day
        if (!isMobDay) {
          const siteContactHidden = document.getElementById('bog-site-contact-hidden');
          if (!siteContactHidden || !siteContactHidden.value.trim()) {
            alert('Please select an Onsite Crew Lead Name.');
            return;
          }
        }

        // 2. SWMS selection is required when not a mobilisation day
        if (!isMobDay) {
          if (!validateSWMS()) {
            showErrorMessage();
            return;
          }
        }

        // 3. Crew count must match selected crew members
                const peopleAtLocation   = Number(document.getElementById('bog-Number-of-People-at-Location')?.value) || 0;
        const selectedCrewHidden = document.getElementById('bog-crews-names-hidden')?.value || '';
        const selectedCrewCount  = selectedCrewHidden.split(',').map(n => n.trim()).filter(n => n.length > 0).length;
        if (peopleAtLocation !== selectedCrewCount) {
          alert(`Number of People at Location (${peopleAtLocation}) must match the number of selected crew members (${selectedCrewCount}).`);
          return;
        }

        // 4. Address must be selected from the Google Maps dropdown
        const locationField = document.getElementById('bog-site-location');
        if (locationField) {
          const hasValue = locationField.value && locationField.value.trim().length > 0;
          const isValid  = locationField.dataset.valid === "true";
          if (!hasValue) { alert('Please enter an address for the site location.'); locationField.focus(); return; }
          if (!isValid)  { alert('Please select a full address from the dropdown for the site location.'); locationField.focus(); return; }
        }

        // 5. Start time must be fully completed
        const startHour    = document.getElementById('bog-start-hour')?.value;
        const startMinutes = document.getElementById('bog-start-minutes')?.value;
        const startAmPm    = document.getElementById('bog-start-ampm')?.value;
        if (!startHour || !startMinutes || !startAmPm) { alert("Please complete the Estimated Start Time (Hour, Minutes, AM/PM)."); return; }
        const formattedStartTime = `${startHour.padStart(2, '0')}:${startMinutes} ${startAmPm}`;
        const startTimestampHidden = document.getElementById('bog-estimated-start-timestamp');
        if (startTimestampHidden) startTimestampHidden.value = formattedStartTime;

        const checkedSWMS = Array.from(document.querySelectorAll('input[name="bog-SWMS[]"]:checked')).map(cb => cb.value);

        const formData = {
          'Date On-Site':              document.getElementById('bog-date').value,
          'Mobilisation':              document.getElementById('bog-mob').checked,
          'De-Mobilisation':           document.getElementById('bog-demob').checked,
          'First Site Location2':      document.getElementById('bog-site-location').value,
          'Estimated Start Time':      formattedStartTime,
          'Hours in Field':            document.getElementById('bog-estimated-hours')?.value || "",
          'Onsite Crew Lead':          document.getElementById('bog-site-contact-hidden').value,
          'Onsite Crew Lead Mobile_original': document.getElementById('bog-onsite-crew-lead-mobile').value,
          'Construction Partner Technician Email': document.getElementById('bog-onsite-crew-lead-email').value,
          'Enable ID (if applicable)': document.getElementById('bog-onsite-crew-lead-EnableID').value,
          'Your Company Name':         document.getElementById('bog-company-name').value,
          'Discipline':                document.getElementById('bog-discipline').value,
          'Number of People at Location?': peopleAtLocation,
          'List Names of Workers in field.': document.getElementById('bog-crews-names-hidden').value,
          'SAM ID (WA)':               document.getElementById('bog-SAM').value,
          'ADA ID':                    document.getElementById('bog-ADA').value,
          'Your Genus FCM':            document.getElementById('bog-Genus-FCM').value,
          'I confirm all workers have been inducted and have signed onto the JHA.': document.getElementById('bog-jha-uploaded').checked,
          'Discipline with task Specific SWMS (SWMS-SHEQ-CMS-0011 Site Establishment, SWMS-SHEQ-CMS-0001 Access to Pits & Manholes - required on all sites, SWMS-SHEQ-CMS-0006 Asbestos (ACM) required for all ACM sites)': checkedSWMS,
          'Will you be disturbing/modifying any possible ACM while onsite?': document.getElementById('bog-ACM').value,
          'Genus ACM Removal Notification Code and placed on your Construction JHA.': document.getElementById('bog-acm-yes').value,
          'Ensure Telstra guards are fully locked around all open manholes.  Calibrated gas detector required for spot sampling manhole access and ongoing monitoring.': document.getElementById('bog-guards').checked,
          'Excavation work- have you follow the 5Ps  with a competent locator onsite?': document.getElementById('bog-excavation').checked,
          'Additional Comments':       document.getElementById('bog-comments').value,
          'Number of Crew vehicles':   document.getElementById('bog-crew-vehicles')?.value || '',
          'Number of heavy vehicles':  document.getElementById('bog-heavy-vehicles')?.value || ''
        };

        try {
          const response = await submitToAirtable('bog', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting BOG form:', error);
          alert('Error submitting form. Please try again.');
        }
      });


      /*  REINSTATEMENT FORM SUBMIT  */
      document.getElementById('reinstatement-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit"; }, 7000);
        }

        if (!validateNoteIdFields([{ id: 'reinstatement-Pit-Note-ID', name: 'Pit Note ID' }])) return;
        
        // Address validation is only required for NEW entries (when address field is not disabled/locked)
        const addressField = document.getElementById('reinstatement-address');
        if (addressField && !addressField.disabled) {
          const hasValue = addressField.value && addressField.value.trim().length > 0;
          const isValid  = addressField.dataset.valid === "true";
          if (!hasValue) { 
            alert('Please enter an address for the reinstatement.'); 
            addressField.focus(); 
            return; 
          }
          if (!isValid) { 
            alert('Please select a full address from the dropdown for the reinstatement.'); 
            addressField.focus(); 
            return; 
          }
        }
        
        if (!validateGenericForm('reinstatement-form')) return;

        const formData = {
          'Your Name':                   document.getElementById('reinstatement-site-contact-hidden').value,
          'Temp Reinstatement Date':     document.getElementById('reinstatement-date').value,
          'Address':                     document.getElementById('reinstatement-address').value,
          'SAM':                         document.getElementById('reinstatement-SAM').value,
          'ADA ID':                      document.getElementById('reinstatement-ADA').value,
          'Pit Note ID':                 document.getElementById('reinstatement-Pit-Note-ID').value,
          'Asset Type':                  document.getElementById('reinstatement-asset-type').value,
          'Surface Type':                document.getElementById('reinstatement-surface-type').value,
          'Surface Type - Other':        document.getElementById('reinstatement-surface-type-other').value,
          'Location Type':               document.getElementById('reinstatement-location-type').value,
          'Location Type - Other':       document.getElementById('reinstatement-location-type-other').value,
          'Temp Material Used':          document.getElementById('reinstatement-material-type').value,
          'Temp Material Used - Other':  document.getElementById('reinstatement-material-type-other').value,
          'Temp Contractor Company Name': document.getElementById('reinstatement-company-name').value,
          'Proposed Permanent Reinstatement Date': document.getElementById('reinstatement-perm-date').value,
          'Permanent Reinstatement Area (m2)': document.getElementById('reinstatement-area').value,
          'Full Panel Required?':        document.getElementById('reinstatement-panel').value,
          'Permanent Material':          document.getElementById('reinstatement-perm-material').value,
          'Permanent Material - Other':  document.getElementById('reinstatement-perm-material-other').value,
          'Permanent Contractor Company Name': document.getElementById('reinstatement-perm-company-name').value,
          'Non-Standard Reinstatement':  document.getElementById('reinstatement-Non-Standard').checked,
          'Additional Comments':         document.getElementById('reinstatement-comments').value,
          'Permanent Reinstatement Completed': document.getElementById('reinstatement-completed').checked
        };

        try {
          const response = await submitToAirtable('reinstatement', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting Reinstatement form:', error);
          alert('Error submitting form. Please try again.');
        }
      });


      /*  PIT LINK-IN FORM SUBMIT  */
      document.getElementById('pitlinkin-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit Pit Link-in"; }, 7000);
        }

        const noteIdFields = [
          { id: 'pitlinkin-Duct-Note-ID',  name: 'Duct Note ID'   },
          { id: 'pitlinkin-PitA-Note-ID',  name: 'Pit A Note ID'  },
          { id: 'pitlinkin-PitB-Note-ID',  name: 'Pit B Note ID'  }
        ];
        if (!validateNoteIdFields(noteIdFields)) return;
        if (!validateGenericForm('pitlinkin-form')) return;

        const formData = {
          'Your Name':            document.getElementById('pitlinkin-site-contact-hidden').value,
          'Pit Link-in Date':     document.getElementById('pitlinkin-date').value,
          'SAM':                  document.getElementById('pitlinkin-SAM').value,
          'ADA ID':               document.getElementById('pitlinkin-ADA').value,
          'Duct Note ID':         document.getElementById('pitlinkin-Duct-Note-ID').value,
          'Pit A Note ID':        document.getElementById('pitlinkin-PitA-Note-ID').value,
          'Pit B Note ID':        document.getElementById('pitlinkin-PitB-Note-ID').value,
          'Pit A Required':       document.getElementById('pitlinkin-PitA-linkin-required').checked,
          'Pit B Required':       document.getElementById('pitlinkin-PitB-linkin-required').checked,
          'Pit A Fit for Purpose': document.getElementById('pitlinkin-PitA-ffp').value,
          'Pit B Fit for Purpose': document.getElementById('pitlinkin-PitB-ffp').value,
          'RRP Completed?':       document.getElementById('pitlinkin-rrp').value,
          'RRP Completed - No':   document.getElementById('pitlinkin-rrp-no').value,
          'Additional Comments':  document.getElementById('pitlinkin-comments').value,
          'Pit Link-ins Completed': document.getElementById('pitlinkin-completed').checked
        };

        try {
          const response = await submitToAirtable('pitlinkin', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting Pit Link-in form:', error);
          alert('Error submitting form. Please try again.');
        }
      });


      /*  VAC TRUCK FORM SUBMIT  */
      document.getElementById('vactruck-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit Vac Truck"; }, 7000);
        }

        if (!validateNoteIdFields([{ id: 'vactruck-Pit-Note-ID', name: 'Pit Note ID' }])) return;
        if (!validateGenericForm('vactruck-form')) return;

        const formData = {
          'Contractor':           document.getElementById('vactruck-company-name').value,
          'Submission Date':      document.getElementById('vactruck-date').value,
          'SAM':                  document.getElementById('vactruck-SAM').value,
          'ADA ID':               document.getElementById('vactruck-ADA').value,
          'Pit Note ID':          document.getElementById('vactruck-Pit-Note-ID').value,
          'Additional Comments':  document.getElementById('vactruck-comments').value,
          'Pit Cleanout Completed': document.getElementById('vactruck-completed').checked
        };

        try {
          const response = await submitToAirtable('vactruck', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting Vac Truck form:', error);
          alert('Error submitting form. Please try again.');
        }
      });


      /*  GEARBOX FORM SUBMIT  */
      document.getElementById('gearbox-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit"; }, 7000);
        }
        if (!validateGenericForm('gearbox-form')) return;

        const formData = {
          'Contractor':           'Genus Services',
          'Entry Person Name':    document.getElementById('gearbox-entry-person-hidden').value,
          'Entry Date':           document.getElementById('gearbox-entry-date').value,
          'Fleet Number':         document.getElementById('gearbox-fleet-number').value,
          'Vehicle Type':         document.getElementById('gearbox-vehicle-type').value,
          'Gear Box F- Number':   document.getElementById('gearbox-gearbox-f-number').value || 'N/A',
          'Maintenance Required': document.getElementById('gearbox-Maintenance-Required').value,
          'Maintenance Completed By': document.getElementById('gearbox-maintenance-completed-by').value,
          'Maintenance Completed By Other': document.getElementById('gearbox-maintenance-completed-by').value === 'Other'
            ? document.getElementById('gearbox-maintenance-other-text').value : '',
          'Repair Location': document.getElementById('gearbox-repair-location').value,
          'Repair Location Other': document.getElementById('gearbox-repair-location').value === 'Other'
            ? document.getElementById('gearbox-repair-other-text').value : '',
          'Estimated Repairs Cost': document.getElementById('gearbox-estimated-cost').value,
          'Estimated Repairs Cost - Quoted Cost': document.getElementById('gearbox-estimated-cost').value === 'Quoted Cost'
            ? document.getElementById('gearbox-estimated-cost-other-text').value : '',
          'Est. Repair Duration': document.getElementById('gearbox-estimated-duration').value
        };

        try {
          const response = await submitToAirtable('gearbox', formData);
          const result   = await response.json();
          if (!response.ok) { console.error('Airtable error:', result); alert(`Submission failed: ${result.error?.message || 'Unknown error'}`); return; }
          showSuccessMessage();
        } catch (error) {
          console.error('Error submitting Fleet Maintenance form:', error);
          alert('Error submitting form. Please try again.');
        }
      });

    }); // end DOMContentLoaded


    /* ============================================================
       15. PIT LINK-IN  AIRTABLE LOOKUP / UPDATE (REST WORKER)
       ============================================================ */

    document.addEventListener('DOMContentLoaded', () => {
      let existingRecordId = null;
      const tableKey = 'pit-link-in';

      const fieldMap = {
        "Your Name":              "site-contact-hidden",
        "Pit Link-in Date":       "date",
        "SAM":                    "SAM",
        "ADA ID":                 "ADA",
        "Duct Note ID":           "Duct-Note-ID",
        "Pit A Note ID":          "PitA-Note-ID",
        "Pit B Note ID":          "PitB-Note-ID",
        "Pit A Required":         "PitA-linkin-required",
        "Pit B Required":         "PitB-linkin-required",
        "Pit A Fit for Purpose":  "PitA-ffp",
        "Pit B Fit for Purpose":  "PitB-ffp",
        "RRP Completed?":         "rrp",
        "RRP Completed - No":     "rrp-no",
        "Additional Comments":    "comments",
        "Pit Link-ins Completed": "completed"
      };

      function collectFormData() {
        const data = {};
        for (const [airtableField, elementId] of Object.entries(fieldMap)) {
          const element = document.getElementById(`pitlinkin-${elementId}`);
          if (!element) continue;
          let value;
          if (element.type === 'checkbox') { value = element.checked; }
          else if (element.value && element.value.trim() !== '') { value = element.value.trim(); }
          if (value !== undefined && value !== null && value !== '') data[airtableField] = value;
        }
        return data;
      }

      function initializeForm() {
        document.getElementById('pitlinkin-completed').disabled = true;
      }

      async function searchDuctNoteID() {
        const noteId  = document.getElementById('pitlinkin-note-id-search').value.trim();
        const summary = document.getElementById('pitlinkin-note-summary');
        summary.textContent = '';
        if (!noteId) { alert('Please enter a Note ID to search.'); return; }

        try {
          const response    = await fetch(`${AIRTABLE_API_BASE}/lookup/${tableKey}?noteId=${encodeURIComponent(noteId)}`);
          const contentType = response.headers.get('Content-Type') || '';
          if (!response.ok) {
            const message = contentType.includes('application/json')
              ? (await response.json()).error || 'Lookup failed'
              : await response.text();
            throw new Error(message);
          }
          const data      = await response.json();
          const submitBtn = document.getElementById('pitlinkin-submit-btn');

          if (!data.record) {
            summary.textContent = 'No record found. A new entry will need to be created.';
            existingRecordId    = null;
            unlockForm();
            document.getElementById('pitlinkin-completed').disabled = true;
            submitBtn.textContent = 'Submit';
          } else {
            summary.textContent = 'Record found. All fields locked except completion checkbox.';
            existingRecordId    = data.record.id;
            populateAndLockForm(data.record.fields);
            submitBtn.textContent = 'Update';
          }
        } catch (err) {
          console.error(err);
          summary.textContent = 'Error looking up Note ID.';
        }
      }

      function populateAndLockForm(fields) {
        unlockForm();
        for (const [key, value] of Object.entries(fields)) {
          const mappedId = fieldMap[key] || key;
          const el       = document.getElementById(`pitlinkin-${mappedId}`);
          if (!el) continue;
          
          // Special handling for crew contact name - show as disabled text field
          if (mappedId === 'site-contact-hidden') {
            const hiddenInput = el; // This is already the hidden input
            const containerDiv = document.getElementById('pitlinkin-site-contact');
            if (containerDiv && value) {
              hiddenInput.value = value;
              // Clear the radio button container and replace with a disabled text input
              containerDiv.innerHTML = '';
              const textInput = document.createElement('input');
              textInput.type = 'text';
              textInput.value = value;
              textInput.disabled = true;
              textInput.style.width = '100%';
              containerDiv.appendChild(textInput);
            }
            continue;
          }
          
          if (el.type === 'checkbox') {
            el.checked = value === true;
          } else if (el.tagName === 'SELECT') {
            if (![...el.options].some(opt => opt.value === value) && value != null) {
              const newOption = document.createElement('option');
              newOption.value = value; newOption.textContent = value; newOption.selected = true;
              el.appendChild(newOption);
            }
            el.value = value;
          } else {
            el.value = value;
          }
          if (value !== undefined && value !== null && value !== '') {
            el.disabled = true;
            if (el.hasAttribute('required') && el.id !== 'pitlinkin-rrp-no') {
              el.removeAttribute('required');
              el.setAttribute('data-was-required', 'true');
            }
          } else {
            if (el.hasAttribute('data-was-required') && el.id !== 'pitlinkin-rrp-no') {
              el.setAttribute('required', '');
              el.removeAttribute('data-was-required');
            }
          }
        }
        const completedCheckbox = document.getElementById('pitlinkin-completed');
        if (completedCheckbox) completedCheckbox.disabled = false;
        const rrpSelect = document.getElementById('pitlinkin-rrp');
        if (rrpSelect && typeof toggleRRPCompleteField === 'function') toggleRRPCompleteField();
      }

      function unlockForm() {
        document.querySelectorAll('#pitlinkin-form input, #pitlinkin-form select, #pitlinkin-form textarea').forEach(el => {
          el.disabled = false;
          if (el.hasAttribute('data-was-required') && el.id !== 'pitlinkin-rrp-no') {
            el.setAttribute('required', '');
            el.removeAttribute('data-was-required');
          }
        });
        
        // Restore crew contact radio buttons if they were replaced with a text field
        const crewContactDiv = document.getElementById('pitlinkin-site-contact');
        if (crewContactDiv && crewContactDiv.querySelector('input[type="text"]')) {
          // Re-fetch the crew list and rebuild the radio buttons
          // Pit Link-in doesn't have a company field, so it uses Genus Services
          fetchCrewNames('Genus Services').then(crewList => {
            const hiddenInput = document.getElementById('pitlinkin-site-contact-hidden');
            if (hiddenInput) {
              createRadioList(crewContactDiv, hiddenInput, crewList);
            }
          });
        }
      }

      initializeForm();
      document.getElementById('pitlinkin-search-btn').addEventListener('click', searchDuctNoteID);

      document.getElementById('pitlinkin-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitButton = this.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit Pit Link-in"; }, 7000);
        }

        const noteIdEntered      = document.getElementById('pitlinkin-note-id-search').value.trim();
        const completedCheckbox  = document.getElementById('pitlinkin-completed');
        const isChecked          = completedCheckbox.checked;

        if (existingRecordId) {
          if (!noteIdEntered) { alert('Note ID is required.'); return; }
          if (!isChecked) { alert("Please check 'Pit Link-ins Completed' before submitting."); return; }

          let data = { "Pit Link-ins Completed": true };
          const now       = new Date();
          const perthTime = new Date(now.toLocaleString("en-US", { timeZone: "Australia/Perth" }));
          data["Pit Link-in Completed Timestamp"] = `${perthTime.getFullYear()}-${String(perthTime.getMonth() + 1).padStart(2,'0')}-${String(perthTime.getDate()).padStart(2,'0')}`;

          for (const [airtableField, formFieldId] of Object.entries(fieldMap)) {
            const el = document.getElementById(`pitlinkin-${formFieldId}`);
            if (el && !el.disabled && airtableField !== "Pit Link-ins Completed") {
              if (el.type === 'checkbox') data[airtableField] = el.checked;
              else if (el.value && el.value.trim() !== '') data[airtableField] = el.value.trim();
            }
          }

          try {
            const response = await fetch(`${AIRTABLE_API_BASE}/update/${tableKey}/${existingRecordId}`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ fields: data })
            });
            const result = await response.json();
            if (!response.ok) { alert(`Update failed: ${result.error || 'Unknown error'}`); return; }
            alert('Record updated successfully!');
            location.reload();
          } catch (err) { console.error('Update error:', err); alert('There was an error updating the record.'); }

        } else {
          const data = collectFormData();
          try {
            const response = await fetch(`${AIRTABLE_API_BASE}/create/${tableKey}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ fields: data })
            });
            const result = await response.json();
            if (!response.ok) { alert('Failed to create new record.'); console.error('Create error:', result); return; }
            alert('New record created successfully!');
            location.reload();
          } catch (err) { console.error(err); alert('There was an error creating the record.'); }
        }
      });
    });


    /* ============================================================
       16. VAC TRUCK  AIRTABLE LOOKUP / UPDATE (REST WORKER)
       ============================================================ */

    document.addEventListener('DOMContentLoaded', () => {
      let existingRecordId = null;
      const tableKey = 'vactruck';

      const fieldMap = {
        "Contractor":             "company-name",
        "Submission Date":        "date",
        "SAM":                    "SAM",
        "ADA ID":                 "ADA",
        "Pit Note ID":            "Pit-Note-ID",
        "Additional Comments":    "comments",
        "Pit Cleanout Completed": "completed"
      };

      function initializeForm() {
        document.getElementById('vactruck-completed').disabled = true;
      }

      async function searchvactruckNoteID() {
        const noteId  = document.getElementById('vactruck-note-id-search').value.trim();
        const summary = document.getElementById('vactruck-note-summary');
        summary.textContent = '';
        if (!noteId) { alert('Please enter a Note ID to search.'); return; }

        try {
          const response    = await fetch(`${AIRTABLE_API_BASE}/lookup/${tableKey}?noteId=${encodeURIComponent(noteId)}`);
          const contentType = response.headers.get('Content-Type') || '';
          if (!response.ok) {
            const message = contentType.includes('application/json')
              ? (await response.json()).error || 'Lookup failed'
              : await response.text();
            throw new Error(message);
          }
          const data      = await response.json();
          const submitBtn = document.getElementById('vactruck-submit-btn');

          if (!data.record) {
            summary.textContent = 'No record found. A new entry will need to be created.';
            existingRecordId    = null;
            unlockForm();
            document.getElementById('vactruck-completed').disabled = true;
            submitBtn.textContent = 'Submit';
          } else {
            summary.textContent = 'Record found. All fields locked except completion checkbox.';
            existingRecordId    = data.record.id;
            populateAndLockForm(data.record.fields);
            submitBtn.textContent = 'Update';
          }
        } catch (err) { console.error(err); summary.textContent = 'Error looking up Note ID.'; }
      }

      function populateAndLockForm(fields) {
        unlockForm();
        for (const [key, value] of Object.entries(fields)) {
          const mappedId = fieldMap[key] || key;
          const el       = document.getElementById(`vactruck-${mappedId}`);
          if (!el) continue;
          if (el.type === 'checkbox') { el.checked = value === true; }
          else if (el.tagName === 'SELECT') {
            if (![...el.options].some(opt => opt.value === value) && value != null) {
              const newOption = document.createElement('option');
              newOption.value = value; newOption.textContent = value; newOption.selected = true;
              el.appendChild(newOption);
            }
            el.value = value;
          } else { el.value = value; }
          if (value !== undefined && value !== null && value !== '') {
            el.disabled = true;
            if (el.hasAttribute('required')) { el.removeAttribute('required'); el.setAttribute('data-was-required', 'true'); }
          } else {
            if (el.hasAttribute('data-was-required')) { el.setAttribute('required', ''); el.removeAttribute('data-was-required'); }
          }
        }
        const completedCheckbox = document.getElementById('vactruck-completed');
        if (completedCheckbox) completedCheckbox.disabled = false;
      }

      function unlockForm() {
        document.querySelectorAll('#vactruck-form input, #vactruck-form select, #vactruck-form textarea').forEach(el => {
          el.disabled = false;
          if (el.hasAttribute('data-was-required')) { el.setAttribute('required', ''); el.removeAttribute('data-was-required'); }
        });
      }

      initializeForm();
      document.getElementById('vactruck-search-btn').addEventListener('click', searchvactruckNoteID);

      document.getElementById('vactruck-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const noteIdEntered     = document.getElementById('vactruck-note-id-search').value.trim();
        const completedCheckbox = document.getElementById('vactruck-completed');
        const isChecked         = completedCheckbox.checked;

        let noteIdForSubmission = noteIdEntered;
        if (!existingRecordId) {
          const noteIdFormField = document.getElementById('vactruck-Pit-Note-ID');
          if (noteIdFormField && noteIdFormField.value.trim()) noteIdForSubmission = noteIdFormField.value.trim();
        }
        if (!noteIdForSubmission) { alert('Note ID is required.'); return; }
        if (existingRecordId && !isChecked) { alert("Please check 'Pit Cleanout Completed' before submitting."); return; }

        let data = {};

        if (existingRecordId) {
          data["Pit Cleanout Completed"] = true;
          const now       = new Date();
          const perthTime = new Date(now.toLocaleString("en-US", { timeZone: "Australia/Perth" }));
          data["Pit Cleanout Datestamp"] = `${perthTime.getFullYear()}-${String(perthTime.getMonth() + 1).padStart(2,'0')}-${String(perthTime.getDate()).padStart(2,'0')}`;
          for (const [airtableField, formFieldId] of Object.entries(fieldMap)) {
            const el = document.getElementById(`vactruck-${formFieldId}`);
            if (el && !el.disabled && airtableField !== "Pit Cleanout Completed") {
              if (el.type === 'checkbox') data[airtableField] = el.checked;
              else if (el.value && el.value.trim() !== '') data[airtableField] = el.value.trim();
            }
          }
        } else {
          for (const [airtableField, formFieldId] of Object.entries(fieldMap)) {
            const el = document.getElementById(`vactruck-${formFieldId}`);
            if (el) {
              if (el.type === 'checkbox') data[airtableField] = el.checked;
              else if (el.value && el.value.trim() !== '') data[airtableField] = el.value.trim();
            }
          }
          data["Pit Note ID"] = noteIdForSubmission;
          const now       = new Date();
          const perthTime = new Date(now.toLocaleString("en-US", { timeZone: "Australia/Perth" }));
          data["Submission Date"] = `${perthTime.getFullYear()}-${String(perthTime.getMonth() + 1).padStart(2,'0')}-${String(perthTime.getDate()).padStart(2,'0')}`;
        }

        try {
          const url      = existingRecordId ? `${AIRTABLE_API_BASE}/update/${tableKey}/${existingRecordId}` : `${AIRTABLE_API_BASE}/create/${tableKey}`;
          const method   = existingRecordId ? 'PATCH' : 'POST';
          const response = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ fields: data }) });
          const result   = await response.json();
          if (!response.ok) { alert(`${existingRecordId ? 'Update' : 'Submission'} failed: ${result.error || 'Unknown error'}`); return; }
          alert(`Record ${existingRecordId ? 'updated' : 'created'} successfully!`);
          location.reload();
        } catch (err) { console.error('Submission error:', err); alert(`There was an error ${existingRecordId ? 'updating' : 'creating'} the record.`); }
      });
    });


    /* ============================================================
       17. REINSTATEMENT  AIRTABLE LOOKUP / UPDATE (REST WORKER)
       ============================================================ */

    document.addEventListener('DOMContentLoaded', () => {
      let existingRecordId = null;
      const tableKey = 'reinstatement';

      const fieldMap = {
        "Temp Reinstatement Date":               "date",
        "Your Name":                             "site-contact",
        "Address":                               "address",
        "SAM":                                   "SAM",
        "ADA ID":                                "ADA",
        "Pit Note ID":                           "Pit-Note-ID",
        "Asset Type":                            "asset-type",
        "Surface Type":                          "surface-type",
        "Surface Type - Other":                  "surface-type-other",
        "Location Type":                         "location-type",
        "Location Type - Other":                 "location-type-other",
        "Temp Material Used":                    "material-type",
        "Temp Material Used - Other":            "material-type-other",
        "Temp Contractor Company Name":          "company-name",
        "Proposed Permanent Reinstatement Date": "perm-date",
        "Permanent Reinstatement Area (m2)":     "area",
        "Full Panel Required?":                  "panel",
        "Permanent Material":                    "perm-material",
        "Permanent Material - Other":            "perm-material-other",
        "Permanent Contractor Company Name":     "perm-company-name",
        "Non-Standard Reinstatement":            "Non-Standard",
        "Additional Comments":                   "comments",
        "Permanent Reinstatement Completed":     "completed"
      };

      const completionFieldIds = [
        'reinstatement-perm-material',
        'reinstatement-perm-material-other',
        'reinstatement-perm-company-name',
        'reinstatement-Non-Standard',
        'reinstatement-comments',
        'reinstatement-completed'
      ];

      function collectFormData() {
        const data = {};
        for (const [airtableField, elementId] of Object.entries(fieldMap)) {
          const element = document.getElementById(`reinstatement-${elementId}`);
          if (!element) continue;
          let value;
          if (element.type === 'checkbox') { value = element.checked; }
          else if (element.value && element.value.trim() !== '') { value = element.value.trim(); }
          if (value !== undefined && value !== null && value !== '') data[airtableField] = value;
        }
        return data;
      }

      function lockCompletionFields() {
        completionFieldIds.forEach(fieldId => {
          const element = document.getElementById(fieldId);
          if (element) element.disabled = true;
        });
      }

      function unlockForm() {
        document.querySelectorAll('#reinstatement-form input, #reinstatement-form select, #reinstatement-form textarea')
          .forEach(el => el.disabled = false);
        
        // Restore crew contact radio buttons if they were replaced with a text field
        const crewContactDiv = document.getElementById('reinstatement-site-contact');
        const companyField = document.getElementById('reinstatement-company-name');
        if (crewContactDiv && companyField && crewContactDiv.querySelector('input[type="text"]')) {
          // Re-fetch the crew list and rebuild the radio buttons
          const companyName = companyField.value || 'Genus Services';
          fetchCrewNames(companyName).then(crewList => {
            const hiddenInput = document.getElementById('reinstatement-site-contact-hidden');
            if (hiddenInput) {
              createRadioList(crewContactDiv, hiddenInput, crewList);
            }
          });
        }
      }

      async function searchreinstatementNoteID() {
        const noteId  = document.getElementById('reinstatement-note-id-search').value.trim();
        const summary = document.getElementById('reinstatement-note-summary');
        summary.textContent = '';
        if (!noteId) { alert('Please enter a Note ID to search.'); return; }

        try {
          const response    = await fetch(`${AIRTABLE_API_BASE}/lookup/${tableKey}?noteId=${encodeURIComponent(noteId)}`);
          const contentType = response.headers.get('Content-Type') || '';
          if (!response.ok) {
            const message = contentType.includes('application/json')
              ? (await response.json()).error || 'Lookup failed'
              : await response.text();
            throw new Error(message);
          }
          const data      = await response.json();
          const submitBtn = document.getElementById('reinstatement-submit-btn');

          if (!data.record) {
            summary.textContent = 'No record found. A new entry will need to be created.';
            existingRecordId    = null;
            unlockForm();
            lockCompletionFields();
            submitBtn.textContent = 'Submit';
          } else {
            summary.textContent = 'Record found. Populated fields locked, unpopulated fields available for editing.';
            existingRecordId    = data.record.id;
            populateAndLockForm(data.record.fields);
            submitBtn.textContent = 'Update';
          }
        } catch (err) { console.error(err); summary.textContent = 'Error looking up Note ID.'; }
      }

      function populateAndLockForm(fields) {
        unlockForm();
        for (const [key, value] of Object.entries(fields)) {
          const mappedId = fieldMap[key] || key;
          const el       = document.getElementById(`reinstatement-${mappedId}`);
          if (!el) continue;
          
          // Special handling for crew contact name - show as disabled text field
          if (mappedId === 'site-contact') {
            const hiddenInput = document.getElementById('reinstatement-site-contact-hidden');
            if (hiddenInput && value) {
              hiddenInput.value = value;
              // Clear the radio button container and replace with a disabled text input
              el.innerHTML = '';
              const textInput = document.createElement('input');
              textInput.type = 'text';
              textInput.value = value;
              textInput.disabled = true;
              textInput.style.width = '100%';
              el.appendChild(textInput);
            }
            continue;
          }
          
          if (el.type === 'checkbox') { el.checked = value === true; }
          else if (el.tagName === 'SELECT') {
            if (![...el.options].some(opt => opt.value === value) && value != null) {
              const newOption = document.createElement('option');
              newOption.value = value; newOption.textContent = value; newOption.selected = true;
              el.appendChild(newOption);
            }
            el.value = value;
          } else { el.value = value; }
          if (value !== undefined && value !== null && value !== '') el.disabled = true;
        }
      }

      lockCompletionFields(); // Lock completion fields on initial page load
      document.getElementById('reinstatement-search-btn').addEventListener('click', searchreinstatementNoteID);

      document.getElementById('reinstatement-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const submitButton = document.getElementById('reinstatement-submit-btn');
        if (submitButton) {
          submitButton.disabled    = true;
          submitButton.textContent = "Submitting...";
          setTimeout(() => { submitButton.disabled = false; submitButton.textContent = "Submit Reinstatement"; }, 7000);
        }

        const noteIdEntered     = document.getElementById('reinstatement-note-id-search').value.trim();
        const completedCheckbox = document.getElementById('reinstatement-completed');
        const isChecked         = completedCheckbox.checked;

        if (existingRecordId) {
          if (!noteIdEntered) return;
          if (!isChecked) { alert("Please check 'Permanent Reinstatement Completed' before submitting."); return; }

          let data = { "Permanent Reinstatement Completed": isChecked };
          if (isChecked) {
            const now       = new Date();
            const perthTime = new Date(now.toLocaleString("en-US", { timeZone: "Australia/Perth" }));
            data["Permanent Reinstatement Timestamp"] = `${perthTime.getFullYear()}-${String(perthTime.getMonth() + 1).padStart(2,'0')}-${String(perthTime.getDate()).padStart(2,'0')}`;
          }
          const permMaterial    = document.getElementById('reinstatement-perm-material').value;
          const permMatOther    = document.getElementById('reinstatement-perm-material-other').value;
          const permCompanyName = document.getElementById('reinstatement-perm-company-name').value;
          const nonStandard     = document.getElementById('reinstatement-Non-Standard').checked;
          const comments        = document.getElementById('reinstatement-comments').value;

          if (permMaterial)    data["Permanent Material"]                   = permMaterial;
          if (permMatOther)    data["Permanent Material - Other"]           = permMatOther;
          if (permCompanyName) data["Permanent Contractor Company Name"]    = permCompanyName;
          data["Non-Standard Reinstatement"] = nonStandard;
          if (comments)        data["Additional Comments"]                  = comments;

          try {
            const response = await fetch(`${AIRTABLE_API_BASE}/update/${tableKey}/${existingRecordId}`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ fields: data })
            });
            const result = await response.json();
            if (!response.ok) { alert('Update failed.'); return; }
            alert('Record updated successfully!');
            location.reload();
          } catch (err) { console.error(err); alert('There was an error updating the record.'); }

        } else {
          const data = collectFormData();
          try {
            const response = await fetch(`${AIRTABLE_API_BASE}/create/${tableKey}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ fields: data })
            });
            const result = await response.json();
            if (!response.ok) { alert('Failed to create new record.'); console.error('Create error:', result); return; }
            alert('New record created successfully!');
            location.reload();
          } catch (err) { console.error(err); alert('There was an error creating the record.'); }
        }
      });
    });

  </script>

  <!-- Google Maps Places API  callback triggers initAutocomplete() defined above -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-EKPtC5W7fRHgiONVPIyGsVU7Ti_xjBc&loading=async&libraries=places&callback=initAutocomplete" async defer></script>

</body>
</html>